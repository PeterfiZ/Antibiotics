<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4f46e5"/>
    <title>Antibiotikum alkalmaz√°si seg√©dlet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        .module-card {
            transition: all 0.3s ease;
        }
        .module-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .search-input {
            transition: all 0.2s ease;
        }
        .search-input:focus {
            transform: scale(1.02);
        }
        .gfr-normal { background-color: #f0fdf4; } /* green-50 */
        .gfr-moderate { background-color: #fefce8; } /* yellow-50 */
        .gfr-mild-moderate { background-color: #eff6ff; } /* blue-50 */
        .gfr-severe { background-color: #fef2f2; } /* red-50 */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #2563eb;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            cursor: pointer;
            display: none;
            z-index: 1000;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Telep√≠t√©si gomb -->
    <div id="installPrompt" class="install-prompt">üì± Telep√≠t√©s</div>

    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-600">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Antibiotikum alkalmaz√°si seg√©dlet</h1>
                </div>
                <div class="flex space-x-2">
                    <button onclick="changeLanguage('hu')" class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" id="lang-hu">HU</button>
                    <button onclick="changeLanguage('en')" class="px-3 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors" id="lang-en">EN</button>
                    <button onclick="changeLanguage('de')" class="px-3 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors" id="lang-de">DE</button>
                </div>
            </div>
            <p class="text-sm text-gray-600 mt-1">
                <span id="copyright">¬© 2025, Dr. P√©terfi Zolt√°n | Verzi√≥: 4.3.6</span>
            </p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <!-- Module Selection -->
        <div id="module-selection" class="fade-in max-w-4xl mx-auto">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center" id="select-module">V√°lasszon modult</h2> 
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div class="module-card bg-white rounded-xl shadow-lg p-4 md:p-6 cursor-pointer border-2 border-transparent hover:border-blue-300" onclick="showModule('pharmacological')">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 7.172V5L8 4z"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2" id="pharm-title">Farmakol√≥giai megk√∂zel√≠t√©s</h3>
                        <p class="text-gray-600" id="pharm-desc">Antibiotikumok tulajdons√°gai √©s hat√°smechanizmusai</p>
                    </div>
                </div>

                <div class="module-card bg-white rounded-xl shadow-lg p-4 md:p-6 cursor-pointer border-2 border-transparent hover:border-green-300" onclick="showModule('clinical')">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2" id="clin-title">Klinikai megk√∂zel√≠t√©s</h3>
                        <p class="text-gray-600" id="clin-desc">Betegs√©gek √©s ter√°pi√°s protokollok</p>
                    </div>
                </div>

                <div class="module-card bg-white rounded-xl shadow-lg p-4 md:p-6 cursor-pointer border-2 border-transparent hover:border-purple-300" onclick="showModule('microbiological')">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2" id="micro-title">Mikrobiol√≥giai megk√∂zel√≠t√©s</h3>
                        <p class="text-gray-600" id="micro-desc">K√≥rokoz√≥k √©s √©rz√©kenys√©gi spektrum</p>
                    </div>
                </div>
                <div class="module-card bg-white rounded-xl shadow-lg p-4 md:p-6 cursor-pointer border-2 border-transparent hover:border-orange-300" onclick="showModule('summary')">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2" id="summary-title">√ñsszefoglal√≥ t√°bl√°zatok</h3>
                        <p class="text-gray-600" id="summary-desc">Antibiotikumok tulajdons√°gainak √°ttekint≈ë t√°bl√°zata</p>
                    </div>
                </div>
                <div class="module-card bg-white rounded-xl shadow-lg p-4 md:p-6 cursor-pointer border-2 border-transparent hover:border-red-300" onclick="showModule('renal')">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1.615A5 5 0 016.618 15h6.764A5 5 0 0118 19.385V21zM12 4.354V15"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2" id="renal-title">Vesek√°rosod√°s</h3>
                        <p class="text-gray-600" id="renal-desc">D√≥zism√≥dos√≠t√°s vesek√°rosod√°s eset√©n</p>
                    </div>
                </div>
                <div class="module-card bg-white rounded-xl shadow-lg p-4 md:p-6 cursor-pointer border-2 border-transparent hover:border-cyan-300" onclick="showModule('tdm')">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-cyan-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2" id="tdm-title">TDM Kalkul√°tor</h3>
                        <p class="text-gray-600" id="tdm-desc">Gentamicin, Amikacin, Vancomycin, Voriconazole TDM</p>
                    </div>
                </div>
                <div class="module-card bg-white rounded-xl shadow-lg p-4 md:p-6 cursor-pointer border-2 border-transparent hover:border-teal-300" onclick="showModule('sensitivity')">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-teal-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 7.172V5L8 4z"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2" id="sensitivity-title">√ârz√©kenys√©gi Spektrum</h3>
                        <p class="text-gray-600" id="sensitivity-desc">Antibiotikum √©s bakt√©rium √©rz√©kenys√©gi adatok</p>
                    </div>
                </div>
                <div class="module-card bg-white rounded-xl shadow-lg p-4 md:p-6 cursor-pointer border-2 border-transparent hover:border-pink-300" onclick="showModule('pediatric')">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2" id="pediatric-title">Gyermekd√≥zisok</h3>
                        <p class="text-gray-600" id="pediatric-desc">Antibiotikumok d√≥zisai gyermekkorban</p>
                    </div>
                </div>
                <div class="module-card bg-white rounded-xl shadow-lg p-4 md:p-6 cursor-pointer border-2 border-transparent hover:border-yellow-300" onclick="showModule('quiz')">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4c0-1.193.5-2.278 1.28-3.072zM12 18v.01"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2" id="quiz-title">Tud√°sfelm√©r≈ë</h3>
                        <p class="text-gray-600" id="quiz-desc">Tesztelje tud√°s√°t interakt√≠v kv√≠zekkel</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pharmacological Module -->
        <div id="pharmacological-module" class="hidden fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800" id="pharm-module-title">Farmakol√≥giai megk√∂zel√≠t√©s</h2>
                <div class="flex items-center space-x-3">
                    <button onclick="exportToPDF('detailed')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2" id="export-detailed-pdf-btn">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span id="export-detailed-pdf-btn-text">R√©szletes PDF</span>
                    </button>
                    <button onclick="showModuleSelection()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors" id="back-btn">Vissza</button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" id="search-name">Keres√©s n√©v szerint:</label>
                        <input type="text" id="pharm-search" placeholder="Antibiotikum neve..." class="search-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" id="filter-group">Sz≈±r√©s csoport szerint:</label>
                        <select id="pharm-group-filter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="" id="all-groups">Minden csoport</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="grid lg:grid-cols-3 gap-6">
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-xl shadow-lg p-4">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4" id="antibiotic-list">Antibiotikumok list√°ja</h3>
                        <div id="pharm-list" class="space-y-1 max-h-[600px] overflow-y-auto pr-1 custom-scrollbar">
                            <!-- Antibiotics will be populated here -->
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div id="pharm-details" class="text-center text-gray-500">
                            <p id="select-antibiotic">V√°lasszon egy antibiotikumot a r√©szletek megtekint√©s√©hez</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pediatric Module -->
        <div id="pediatric-module" class="hidden fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800" id="pediatric-module-title">Gyermekd√≥zisok</h2>
                <button onclick="showModuleSelection()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors" id="back-btn-8">Vissza</button>
            </div>

            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="p-6 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-800" id="pediatric-table-title">Antibiotikum d√≥zisok gyermekkorban</h3>
                    <p class="text-sm text-gray-600 mt-1" id="pediatric-table-desc">√Åltal√°nos ir√°nymutat√°sok. Mindig orvosi valid√°ci√≥ sz√ºks√©ges!</p>
                    <div class="mt-4">
                        <label for="pediatric-search" class="block text-sm font-medium text-gray-700 mb-2" id="search-pediatric-antibiotic">Keres√©s antibiotikum szerint:</label>
                        <input type="text" id="pediatric-search" placeholder="Antibiotikum neve..." class="search-input w-full md:w-1/2 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                    </div>
                </div>
                
                <div id="pediatric-table-container" class="overflow-x-auto">
                    <table id="pediatric-table" class="w-full">
                        <tbody id="pediatric-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Pediatric dose table content will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Clinical Module -->
        <div id="clinical-module" class="hidden fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800" id="clin-module-title">Klinikai megk√∂zel√≠t√©s</h2>
                <div class="flex items-center space-x-3">
                    <button onclick="exportDiseasesToPDF()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2" id="export-diseases-pdf-btn">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span id="export-diseases-pdf-btn-text">R√©szletes PDF</span>
                    </button>
                    <button onclick="showModuleSelection()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors" id="back-btn-2">Vissza</button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" id="search-disease">Keres√©s betegs√©g szerint:</label>
                        <input type="text" id="clin-search" placeholder="Betegs√©g neve..." class="search-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" id="filter-system">Sz≈±r√©s szervrendszer szerint:</label>
                        <select id="clin-category-filter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            <option value="" id="all-systems">Minden szervrendszer</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="grid lg:grid-cols-3 gap-6">
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-xl shadow-lg p-4">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4" id="disease-list">Betegs√©gek list√°ja</h3>
                        <div id="clin-list" class="space-y-1 max-h-[600px] overflow-y-auto pr-1 custom-scrollbar">
                            <!-- Diseases will be populated here -->
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div id="clin-details">
                            <p id="select-disease">V√°lasszon egy betegs√©get a r√©szletek megtekint√©s√©hez</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Microbiological Module -->
        <div id="microbiological-module" class="hidden fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800" id="micro-module-title">Mikrobiol√≥giai megk√∂zel√≠t√©s</h2>
                <div class="flex items-center space-x-3">
                    <button onclick="exportPathogensToPDF()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2" id="export-pathogens-pdf-btn">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span id="export-pathogens-pdf-btn-text">R√©szletes PDF</span>
                    </button>
                    <button onclick="showModuleSelection()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors" id="back-btn-3">Vissza</button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" id="search-pathogen">Keres√©s k√≥rokoz√≥ szerint:</label>
                        <input type="text" id="micro-search" placeholder="K√≥rokoz√≥ neve..." class="search-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" id="filter-type">Sz≈±r√©s t√≠pus szerint:</label>
                        <select id="micro-type-filter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="" id="all-types">Minden t√≠pus</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="grid lg:grid-cols-3 gap-6">
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-xl shadow-lg p-4">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4" id="pathogen-list">K√≥rokoz√≥k list√°ja</h3>
                        <div id="micro-list" class="space-y-2 max-h-96 overflow-y-auto">
                            <!-- Pathogens will be populated here -->
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div id="micro-details" class="text-center text-gray-500">
                            <p id="select-pathogen">V√°lasszon egy k√≥rokoz√≥t a r√©szletek megtekint√©s√©hez</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary Tables Module -->
        <div id="summary-module" class="hidden fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800" id="summary-module-title">√ñsszefoglal√≥ t√°bl√°zatok</h2>
                <div class="flex items-center space-x-3">
                    <button onclick="exportToPDF('summary')" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors flex items-center space-x-2" id="export-summary-pdf-btn">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span id="export-summary-pdf-btn-text">√ñsszefoglal√≥ PDF</span>
                    </button>
                    <button onclick="showModuleSelection()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors" id="back-btn-4">Vissza</button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="p-6 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-800" id="summary-table-title">Antibiotikumok √∂sszefoglal√≥ t√°bl√°zata</h3>
                    <p class="text-sm text-gray-600 mt-1" id="summary-table-desc">Csoportok szerinti √°ttekint√©s a f≈ëbb tulajdons√°gokkal</p>
                </div>
                
                <div id="summary-table-container" class="overflow-x-auto">
                    <table id="summary-table" class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" id="th-group">Csoport</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" id="th-effect">Hat√°s</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" id="th-mechanism">Hat√°smechanizmus</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" id="th-spectrum">Spektrum</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" id="th-examples">P√©ld√°k</th>
                            </tr>
                        </thead>
                        <tbody id="summary-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Table content will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Quiz Module -->
        <div id="quiz-module" class="hidden fade-in">
            <!-- Setup Screen -->
            <div id="quiz-setup">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800" id="quiz-module-title">Tud√°sfelm√©r≈ë</h2>
                    <button onclick="showModuleSelection()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors" id="back-btn-5">Vissza</button>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-8 max-w-2xl mx-auto">
                    <h3 class="text-xl font-semibold text-center mb-6" id="quiz-setup-title">Kv√≠z be√°ll√≠t√°sai</h3>
                    <div class="space-y-4">
                        <div>
                            <label for="quiz-topic" class="block text-sm font-medium text-gray-700" id="quiz-topic-label">T√©mak√∂r:</label>
                            <select id="quiz-topic" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                <option value="pharmacological" id="topic-pharm">Farmakol√≥giai</option>
                                <option value="clinical" id="topic-clin">Klinikai</option>
                                <option value="microbiological" id="topic-micro">Mikrobiol√≥giai</option>
                            </select>
                        </div>
                        <div>
                            <label for="quiz-questions" class="block text-sm font-medium text-gray-700" id="quiz-questions-label">K√©rd√©sek sz√°ma:</label>
                            <select id="quiz-questions" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="15">15</option>
                            </select>
                        </div>
                        <div>
                            <label for="quiz-difficulty" class="block text-sm font-medium text-gray-700" id="quiz-difficulty-label">Neh√©zs√©g:</label>
                            <select id="quiz-difficulty" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                <option value="easy" id="difficulty-easy">K√∂nny≈±</option>
                                <option value="hard" id="difficulty-hard">Neh√©z</option>
                                <option value="auto-generated" id="difficulty-auto">Automatikus</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-8 text-center">
                        <button onclick="startQuiz()" class="w-full px-6 py-3 bg-yellow-500 text-white font-bold rounded-lg hover:bg-yellow-600 transition-colors text-lg" id="start-quiz-btn">Kv√≠z ind√≠t√°sa</button>
                    </div>
                </div>
            </div>

            <!-- Quiz Area -->
            <div id="quiz-area" class="hidden bg-white rounded-xl shadow-lg p-8 max-w-3xl mx-auto">
                <div class="flex justify-between items-center mb-4">
                    <div id="quiz-progress" class="text-sm font-semibold text-gray-600"></div>
                    <div id="quiz-score" class="text-sm font-semibold text-gray-600"></div>
                </div>
                <div id="question-container" class="mb-6 min-h-[6rem] flex items-center"><p class="text-xl font-medium text-gray-800" id="question-text"></p></div>
                <div id="answers-container" class="space-y-3"></div>
                <div id="feedback-container" class="mt-4 text-center font-bold min-h-[1.5rem]"></div>
                <div class="mt-8 flex justify-end"><button id="next-question-btn" onclick="nextQuestion()" class="hidden px-6 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors">K√∂vetkez≈ë</button></div>
            </div>

            <!-- Results Screen -->
            <div id="quiz-results" class="hidden text-center bg-white rounded-xl shadow-lg p-8 max-w-md mx-auto">
                <h3 class="text-2xl font-bold text-gray-800 mb-4" id="results-title">Eredm√©ny</h3>
                <p class="text-4xl font-bold text-green-600 mb-2" id="final-score"></p>
                <p class="text-gray-600 mb-6" id="score-text"></p>
                <button onclick="restartQuiz()" class="px-6 py-3 bg-yellow-500 text-white font-bold rounded-lg hover:bg-yellow-600 transition-colors" id="restart-quiz-btn">√öj kv√≠z</button>
            </div>
        </div>

        <!-- Renal Dose Module -->
        <div id="renal-module" class="hidden fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800" id="renal-module-title">D√≥zism√≥dos√≠t√°s vesek√°rosod√°s eset√©n</h2>
                <div class="flex items-center space-x-3">
                    <button onclick="exportRenalDosesToPDF()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-2" id="export-renal-pdf-btn">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span id="export-renal-pdf-btn-text">PDF Ment√©s</span>
                    </button>
                    <button onclick="showModuleSelection()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors" id="back-btn-6">Vissza</button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="p-6 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-800" id="renal-table-title">Antibiotikum d√≥zisok vesefunkci√≥ szerint</h3>
                    <p class="text-sm text-gray-600 mt-1" id="renal-table-desc">√Åttekint√©s a GFR √©rt√©kek alapj√°n</p>
                    <div class="mt-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label for="renal-search" class="block text-sm font-medium text-gray-700 mb-2" id="search-renal-antibiotic">Keres√©s antibiotikum szerint:</label>
                                <input type="text" id="renal-search" placeholder="Antibiotikum neve..." class="search-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Alkalmaz√°si m√≥d:</label>
                                <div class="flex space-x-4 mt-2">
                                    <label class="inline-flex items-center"><input type="radio" class="form-radio text-red-600" name="renal-route-filter" value="all" checked><span class="ml-2">√ñsszes</span></label>
                                    <label class="inline-flex items-center"><input type="radio" class="form-radio text-blue-600" name="renal-route-filter" value="IV"><span class="ml-2">IV</span></label>
                                    <label class="inline-flex items-center"><input type="radio" class="form-radio text-yellow-600" name="renal-route-filter" value="PO"><span class="ml-2">PO (Or√°lis)</span></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="renal-table-container" class="overflow-x-auto">
                    <table id="renal-table" class="w-full">
                        <thead class="bg-gray-100 border-b-2 border-gray-300">
                            <tr>
                                <th id="th-renal-antibiotic" onclick="sortRenalTable('antibiotic_name')" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider cursor-pointer select-none hover:bg-gray-200">Antibiotikum</th>
                                <th id="th-renal-gfr50" onclick="sortRenalTable('gfr_gt_50')" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider gfr-normal cursor-pointer select-none hover:brightness-95">GFR >50</th>
                                <th id="th-renal-gfr30-50" onclick="sortRenalTable('gfr_30_50')" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider gfr-mild-moderate cursor-pointer select-none hover:brightness-95">GFR 30-50</th>
                                <th id="th-renal-gfr10-29" onclick="sortRenalTable('gfr_10_29')" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider gfr-moderate cursor-pointer select-none hover:brightness-95">GFR 10-29</th>
                                <th id="th-renal-gfr-lt10" onclick="sortRenalTable('gfr_lt_10')" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider gfr-severe cursor-pointer select-none hover:brightness-95">GFR &lt;10</th>
                                <th id="th-renal-hd" onclick="sortRenalTable('hd')" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider cursor-pointer select-none hover:bg-gray-200">HD</th>
                                <th id="th-renal-crrt" onclick="sortRenalTable('crrt')" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider cursor-pointer select-none hover:bg-gray-200">CRRT</th>
                            </tr>
                        </thead>
                        <tbody id="renal-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Renal dose table content will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TDM Module -->
        <div id="tdm-module" class="hidden fade-in">
            <div class="flex justify-between items-center mb-6">
                <button onclick="showModuleSelection()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors" id="back-btn-7">Vissza</button>
                <button onclick="fillTdmWithTestData()" class="px-4 py-2 bg-indigo-100 text-indigo-700 border border-indigo-200 rounded-lg hover:bg-indigo-200 transition-colors font-semibold text-sm">‚ö° Gyors kit√∂lt√©s (Teszt)</button>
            </div>
            <div class="container mx-auto px-4 py-8 max-w-5xl font-sans">
                <div class="mb-10 text-center">
                    <h1 class="text-4xl font-extrabold text-slate-800 mb-3 tracking-tight">
                        üß¨ TDM Kalkul√°tor
                    </h1>
                    <p class="text-slate-500 text-lg">Therapeutic Drug Monitoring & D√≥zis Optimaliz√°l√°s</p>
                    <p class="text-xs text-slate-400 mt-2">¬© 2025 Dr. P√©terfi Zolt√°n | Verzi√≥ 4.3.6</p>
                </div>

                <!-- Main Input Section -->
                <div class="grid lg:grid-cols-2 gap-6 mb-8">
                    
                    <!-- Patient Data Card -->
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                        <div class="bg-slate-50 px-4 py-3 border-b border-slate-100 flex items-center gap-2">
                            <span class="text-xl">üë§</span>
                            <h2 class="text-lg font-bold text-slate-700">Beteg adatok</h2>
                        </div>
                        
                        <div class="p-4 space-y-3">
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <div>
                                    <label class="block text-[10px] font-semibold text-slate-500 uppercase tracking-wider mb-0.5">Sz√ºlet√©si √©v</label>
                                    <input type="number" id="birthYear" placeholder="1980" class="tdm-input w-full px-3 py-1.5 text-sm bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all outline-none">
                                    <p class="error-message text-red-500 text-xs mt-0.5 hidden"></p>
                                </div>
                                <div>
                                    <label class="block text-[10px] font-semibold text-slate-500 uppercase tracking-wider mb-0.5">Nem</label>
                                    <select id="gender" class="tdm-input w-full px-3 py-1.5 text-sm bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all outline-none">
                                        <option value="male">F√©rfi</option>
                                        <option value="female">N≈ë</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-[10px] font-semibold text-slate-500 uppercase tracking-wider mb-0.5">Tests√∫ly (kg)</label>
                                    <input type="number" id="weight" placeholder="70" class="tdm-input w-full px-3 py-1.5 text-sm bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all outline-none">
                                    <p class="error-message text-red-500 text-xs mt-0.5 hidden"></p>
                                </div>
                                <div>
                                    <label class="block text-[10px] font-semibold text-slate-500 uppercase tracking-wider mb-0.5">Magass√°g (cm)</label>
                                    <input type="number" id="height" placeholder="170" class="tdm-input w-full px-3 py-1.5 text-sm bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all outline-none">
                                    <p class="error-message text-red-500 text-xs mt-0.5 hidden"></p>
                                </div>
                            </div>
                            
                            <div class="space-y-3">
                                <div class="bg-blue-50 rounded-xl p-3 border border-blue-100">
                                    <label class="block text-[10px] font-semibold text-blue-800 uppercase tracking-wider mb-1">Vesefunkci√≥</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2 items-end">
                                        <div>
                                            <label class="block text-[10px] text-blue-600 mb-0.5">Se-Kreatinin (Œºmol/L)</label>
                                            <input type="number" id="creatinine" placeholder="88" class="tdm-input w-full px-3 py-1.5 text-sm bg-white border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                        </div>
                                        <div>
                                             <label class="block text-[10px] text-blue-600 mb-0.5">Vagy ismert GFR (mL/min/1.73m¬≤)</label>
                                             <input type="number" id="manualGFR" placeholder="90" class="tdm-input w-full px-3 py-1.5 text-sm bg-white border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                        </div>
                                    </div>
                                    <div id="gfrResult" class="mt-2 pt-2 border-t border-blue-200 hidden flex justify-between items-center">
                                        <span class="text-xs text-blue-800">Sz√°m√≠tott GFR (CKD-EPI):</span>
                                        <span id="gfrValue" class="text-sm font-bold text-blue-700"></span>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-[10px] font-semibold text-slate-500 uppercase tracking-wider mb-0.5">Dial√≠zis st√°tusz</label>
                                    <select id="dialysisType" onchange="updateDialysisInfo()" class="w-full px-3 py-1.5 text-sm bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                        <option value="none">Nincs dial√≠zis</option>
                                        <option value="hd">HD - Hemodial√≠zis</option>
                                        <option value="pd">PD - Peritone√°lis dial√≠zis</option>
                                        <option value="crrt">CRRT - Folyamatos vesep√≥tl√≥ kezel√©s</option>
                                    </select>
                                    <div id="dialysisInfo" class="mt-1 text-[10px] text-orange-600 bg-orange-50 p-1.5 rounded border border-orange-100 hidden"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Drug Selection Card -->
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden flex flex-col">
                        <div class="bg-slate-50 px-4 py-3 border-b border-slate-100 flex items-center gap-2">
                            <span class="text-xl">üíä</span>
                            <h2 class="text-lg font-bold text-slate-700">Ter√°pia be√°ll√≠t√°sa</h2>
                        </div>
                        
                        <div class="p-4 flex-1 flex flex-col space-y-3">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-[10px] font-semibold text-slate-500 uppercase tracking-wider mb-0.5">Hat√≥anyag</label>
                                    <select id="antibiotic" onchange="updateDrugInfo()" class="tdm-input w-full px-3 py-1.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all outline-none text-sm font-medium text-slate-700">
                                        <option value="gentamicin">Gentamicin</option>
                                        <option value="amikacin">Amikacin</option>
                                        <option value="vancomycin">Vancomycin</option>
                                        <option value="voriconazole">Voriconazole</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-[10px] font-semibold text-slate-500 uppercase tracking-wider mb-0.5">Indik√°ci√≥ s√∫lyoss√°ga</label>
                                    <select id="severity" class="tdm-input w-full px-3 py-1.5 text-sm bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all outline-none">
                                        <option value="mild">Enyhe fert≈ëz√©s</option>
                                        <option value="moderate">K√∂zepes fert≈ëz√©s</option>
                                        <option value="severe">S√∫lyos fert≈ëz√©s</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div id="drugInfo" class="bg-emerald-50 rounded-xl p-3 border border-emerald-100 text-xs">
                                <div class="font-semibold text-emerald-800 mb-1">Gentamicin profil</div>
                                <div class="text-emerald-700 space-y-0.5">
                                    <p>‚Ä¢ C√©lszint (Cs√∫cs): <strong>5-10 mg/L</strong></p>
                                    <p>‚Ä¢ C√©lszint (V√∂lgy): <strong>&lt;2 mg/L</strong></p>
                                    <p>‚Ä¢ Felez√©si id≈ë: 2-3 √≥ra (norm√°l vesefunkci√≥)</p>
                                    <p class="mt-1 italic">‚ö†Ô∏è Nefrotoxikus √©s ototoxikus hat√°s√∫!</p>
                                </div>
                            </div>
                            
                            <div id="initialDoseResultColumn" class="hidden mt-auto pt-2 animate-fade-in">
                                <div class="bg-emerald-50 rounded-xl border border-emerald-100 p-3 shadow-sm">
                                    <h2 class="text-xs font-bold text-emerald-900 mb-2 flex items-center gap-2 border-b border-emerald-200/50 pb-1">
                                        üìä Javasolt kezd≈ë d√≥zis
                                    </h2>
                                    <div id="initialDoseContent" class="text-slate-700 text-sm">
                                        <!-- Content will be injected here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TDM Section -->
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden mb-8">
                    <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center gap-2">
                        <span class="text-xl">üìâ</span>
                        <h2 class="text-lg font-bold text-slate-700">TDM Sz√°m√≠t√°s (M√©rt szintek alapj√°n)</h2>
                    </div>
                    
                    <div class="p-6">
                        <div class="grid md:grid-cols-4 gap-6 mb-6">
                            <div>
                                <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1">Jelenlegi d√≥zis (mg)</label>
                                <input type="number" id="dose" placeholder="240" class="tdm-input w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none font-medium">
                                <p class="error-message text-red-500 text-xs mt-1 hidden"></p>
                            </div>
                            
                            <div>
                                <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1">M√©rt v√∂lgyszint (mg/L)</label>
                                <input type="number" id="troughLevel" step="0.1" placeholder="1.5" class="tdm-input w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none font-medium text-purple-700">
                                <p class="error-message text-red-500 text-xs mt-1 hidden"></p>
                            </div>
                            
                            <div>
                                <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1">D√≥zisk√∂z (√≥ra)</label>
                                <input type="number" id="interval" placeholder="24" class="tdm-input w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none font-medium">
                                <p class="error-message text-red-500 text-xs mt-1 hidden"></p>
                            </div>
                            
                            <div>
                                <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1">Steady-state?</label>
                                <select id="steadyState" class="tdm-input w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none">
                                    <option value="yes">Igen (‚â•3-5 d√≥zis)</option>
                                    <option value="no">Nem (Korai m√©r√©s)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flex flex-col md:flex-row gap-6 items-center">
                            <div class="flex-1 bg-blue-50 rounded-xl p-4 border border-blue-100 text-sm text-blue-800 w-full">
                                <strong class="block mb-1 flex items-center gap-2">‚ÑπÔ∏è Mintav√©teli id≈ëpontok:</strong>
                                <ul class="list-disc list-inside space-y-1 text-xs opacity-90">
                                    <li><strong>Aminoglikozidok:</strong> K√∂zvetlen√ºl a k√∂vetkez≈ë d√≥zis el≈ëtt (v√∂lgy).</li>
                                    <li><strong>Vancomycin:</strong> A 4. d√≥zis el≈ëtt (steady-state v√∂lgy).</li>
                                    <li><strong>Voriconazole:</strong> 5-7. napon, d√≥zis el≈ëtt.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Results Section -->
                <div id="results" class="hidden space-y-8 animate-fade-in">
                    
                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- Dose Recommendation (Highlighted) -->
                        <div class="bg-white rounded-xl shadow-xl border-4 border-green-600 p-6 relative overflow-hidden flex flex-col">
                            <div class="absolute top-0 right-0 p-4 opacity-10 text-8xl text-green-600">üíä</div>
                            <h3 class="text-xl font-extrabold text-green-700 uppercase tracking-wider mb-4">Javasolt D√≥zis Korrekci√≥</h3>
                            <div id="doseRecommendation" class="space-y-4 text-lg flex-grow font-medium">
                                <!-- Content injected here needs to be big -->
                            </div>
                            <button onclick="togglePkDetails()" class="mt-auto pt-2 text-xs text-blue-600 hover:text-blue-800 font-semibold self-start flex items-center gap-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>
                                <span>R√©szletes PK param√©terek</span>
                            </button>
                        </div>

                        <!-- Clinical Notes -->
                        <div class="bg-amber-50 rounded-xl p-6 border border-amber-100">
                            <h3 class="text-lg font-semibold text-amber-800 mb-2 flex items-center gap-2">
                                ‚ö†Ô∏è Klinikai megjegyz√©sek
                            </h3>
                            <div id="clinicalNotes" class="text-sm text-amber-900/80 leading-relaxed"></div>
                        </div>
                    </div>
                    
                    <!-- PK Parameters (Hidden by default) -->
                    <div id="pk-details-card" class="hidden bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                        <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 border-b border-slate-100 pb-2">Farmakokinetikai Param√©terek</h3>
                        <div id="pkResults" class="space-y-3 text-sm text-slate-700"></div>
                    </div>

                    <!-- Chart -->
                    <div class="bg-white rounded-2xl shadow-lg p-6 border border-slate-200">
                        <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4">Sz√©rumszint G√∂rbe</h3>
                        <div class="h-80 w-full">
                            <canvas id="tdmChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        
        <!-- Sensitivity Module -->
        <div id="sensitivity-module" class="hidden fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800" id="sensitivity-module-title">√ârz√©kenys√©gi Spektrum</h2>
                <button onclick="showModuleSelection()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors" id="back-btn-9">Vissza</button>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="grid md:grid-cols-2 gap-6 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" id="sensitivity-mode-label">Keres√©s m√≥dja:</label>
                        <div class="flex space-x-4">
                            <label class="inline-flex items-center">
                                <input type="radio" class="form-radio text-teal-600" name="sensitivity-mode" value="antibiotic" checked>
                                <span class="ml-2" id="mode-antibiotic">Antibiotikum alapj√°n</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" class="form-radio text-teal-600" name="sensitivity-mode" value="bacteria">
                                <span class="ml-2" id="mode-bacteria">Bakt√©rium alapj√°n</span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" id="search-sensitivity-label">Keres√©s:</label>
                        <input type="text" id="sensitivity-search" placeholder="√çrjon be nevet..." class="search-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Sz≈±r√©s √©rz√©kenys√©g szerint:</label>
                    <div class="flex flex-wrap gap-4">
                        <label class="inline-flex items-center">
                            <input type="radio" class="form-radio text-teal-600" name="sensitivity-filter" value="all" checked>
                            <span class="ml-2">√ñsszes</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" class="form-radio text-green-600" name="sensitivity-filter" value="S">
                            <span class="ml-2">√ârz√©keny (S)</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" class="form-radio text-yellow-600" name="sensitivity-filter" value="I">
                            <span class="ml-2">M (emelt d√≥zis)</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" class="form-radio text-red-600" name="sensitivity-filter" value="R">
                            <span class="ml-2">Rezisztens (R)</span>
                        </label>
                    </div>
                </div>
                <div class="text-sm text-gray-500 mb-2" id="sensitivity-legend">Jelmagyar√°zat: S - √ârz√©keny, M - Emelt d√≥zis, R - Rezisztens</div>
            </div>

            <div id="sensitivity-results-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Results will be populated here -->
            </div>
        </div>

        <footer class="text-center py-6 mt-8">
            <div class="bg-white rounded-xl shadow-lg p-4 max-w-md mx-auto">
                <p class="text-gray-600 text-sm" id="footer-copyright">
                    ¬© 2025 Dr. P√©terfi Zolt√°n | Verzi√≥: 4.3.6
                </p> 
                <p class="text-xs text-gray-500 mt-1" id="footer-subtitle">
                    Antibiotikum Oktat√≥ Program - Klinikai d√∂nt√©st√°mogat√°s
                </p>
            </div>
        </footer>
    </main>

<script src="antibiotics_hu.js"></script>
<script src="antibiotics_en.js"></script>
<script src="antibiotics_de.js"></script>
<script src="diseases_hu.js"></script>
<script src="diseases_en.js"></script>
<script src="diseases_de.js"></script>
<script src="pathogens_hu.js"></script>
<script src="pathogens_en.js"></script>
<script src="pathogens_de.js"></script>
<script src="test_hu.js"></script>
<script src="test_en.js"></script>
<script src="test_de.js"></script>
<script src="test_new.js"></script>
<script src="renal_dose_hu.js"></script>
<script src="renal_dose_en.js"></script> 
<script src="renal_dose_de.js"></script> 
<script src="tdm_data.js"></script>
<script src="pediatric_doses_en.js"></script>
<script src="pediatric_doses_de.js"></script>
<script src="pediatric_doses_hu.js"></script>
<script src="Bakterial sensitivity.js"></script>
<script src="tdm_module.js"></script> 
<script src="sensitivity_data.js"></script>
<script src="sensitivity_module.js"></script>

<script>
console.log("antibiotics_hu:", window.antibiotics_hu);
console.log("diseases_hu:", window.diseases_hu);
console.log("pathogens_hu:", window.pathogens_hu);
console.log("renal_dose_hu:", window.renal_dose_hu);
console.log("pediatric_doses_hu:", window.pediatric_doses_hu);
console.log("pediatric_doses_en:", window.pediatric_doses_en);
console.log("pediatric_doses_de:", window.pediatric_doses_de);
</script> 

<script>
    let currentLanguage = 'hu';
    let antibiotics, diseases, pathogens, testQuestions, renalDoses, pediatricDoses;
 
    // Quiz state
    let currentQuestions = [];
    let currentQuestionIndex = 0;
    let score = 0;

        const translations = {
            
            hu: { 
                'select-module': 'V√°lasszon modult',
                'pharm-title': 'Farmakol√≥giai megk√∂zel√≠t√©s',
                'pharm-desc': 'Antibiotikumok tulajdons√°gai √©s hat√°smechanizmusai',
                'clin-title': 'Klinikai megk√∂zel√≠t√©s',
                'clin-desc': 'Betegs√©gek √©s ter√°pi√°s protokollok',
                'micro-title': 'Mikrobiol√≥giai megk√∂zel√≠t√©s',
                'micro-desc': 'K√≥rokoz√≥k √©s √©rz√©kenys√©gi spektrum',
                'summary-title': '√ñsszefoglal√≥ t√°bl√°zatok',
                'summary-desc': 'Antibiotikumok tulajdons√°gainak √°ttekint≈ë t√°bl√°zata',
                'renal-title': 'Vesek√°rosod√°s',
                'renal-desc': 'D√≥zism√≥dos√≠t√°s vesek√°rosod√°s eset√©n',
                'quiz-title': 'Tud√°sfelm√©r≈ë',
                'quiz-desc': 'Tesztelje tud√°s√°t interakt√≠v kv√≠zekkel',
                'tdm-title': 'TDM Kalkul√°tor',
                'tdm-desc': 'Gentamicin, Amikacin, Vancomycin, Voriconazole TDM',
                'sensitivity-title': '√ârz√©kenys√©gi Spektrum',
                'sensitivity-desc': 'Antibiotikum √©s bakt√©rium √©rz√©kenys√©gi adatok',
                'sensitivity-module-title': '√ârz√©kenys√©gi Spektrum',
                'search-sensitivity-label': 'Keres√©s:',
                'sensitivity-mode-label': 'Keres√©s m√≥dja:',
                'mode-antibiotic': 'Antibiotikum alapj√°n',
                'mode-bacteria': 'Bakt√©rium alapj√°n',
                'sensitivity-legend': 'Jelmagyar√°zat: S - √ârz√©keny, I - Emelt d√≥zis, R - Rezisztens',
                'pediatric-table-desc': '√Åltal√°nos ir√°nymutat√°sok. Mindig orvosi valid√°ci√≥ sz√ºks√©ges!',
                'search-pediatric-antibiotic': 'Keres√©s antibiotikum szerint:',
                'pediatric-title': 'Gyermekd√≥zisok',
                'pediatric-desc': 'Antibiotikumok d√≥zisai gyermekkorban',
                'pediatric-module-title': 'Gyermekd√≥zisok',
                'renal-module-title': 'D√≥zism√≥dos√≠t√°s vesek√°rosod√°s eset√©n',
                'renal-table-title': 'Antibiotikum d√≥zisok vesefunkci√≥ szerint',
                'quiz-module-title': 'Tud√°sfelm√©r≈ë',
                'quiz-setup-title': 'Kv√≠z be√°ll√≠t√°sai',
                'quiz-topic-label': 'T√©mak√∂r:',
                'topic-pharm': 'Farmakol√≥giai',
                'topic-clin': 'Klinikai',
                'topic-micro': 'Mikrobiol√≥giai',
                'quiz-questions-label': 'K√©rd√©sek sz√°ma:',
                'quiz-difficulty-label': 'Neh√©zs√©g:',
                'difficulty-easy': 'K√∂nny≈±',
                'difficulty-hard': 'Neh√©z',
                'difficulty-auto': 'Automatikus',
                'start-quiz-btn': 'Kv√≠z ind√≠t√°sa',
                'pharm-module-title': 'Farmakol√≥giai megk√∂zel√≠t√©s',
                'clin-module-title': 'Klinikai megk√∂zel√≠t√©s',
                'micro-module-title': 'Mikrobiol√≥giai megk√∂zel√≠t√©s',
                'summary-module-title': '√ñsszefoglal√≥ t√°bl√°zatok',
                'back-btn': 'Vissza',
                'search-name': 'Keres√©s n√©v szerint:',
                'search-disease': 'Keres√©s betegs√©g szerint:',
                'back-btn-9': 'Vissza',
                'search-pathogen': 'Keres√©s k√≥rokoz√≥ szerint:',
                'filter-group': 'Sz≈±r√©s csoport szerint:',
                'filter-system': 'Sz≈±r√©s szervrendszer szerint:',
                'filter-type': 'Sz≈±r√©s t√≠pus szerint:',
                'all-groups': 'Minden csoport',
                'all-systems': 'Minden szervrendszer',
                'all-types': 'Minden t√≠pus',
                'antibiotic-list': 'Antibiotikumok list√°ja',
                'disease-list': 'Betegs√©gek list√°ja',
                'pathogen-list': 'K√≥rokoz√≥k list√°ja',
                'select-antibiotic': 'V√°lasszon egy antibiotikumot a r√©szletek megtekint√©s√©hez',
                'select-disease': 'V√°lasszon egy betegs√©get a r√©szletek megtekint√©s√©hez',
                'select-pathogen': 'V√°lasszon egy k√≥rokoz√≥t a r√©szletek megtekint√©s√©hez',
                'summary-table-title': 'Antibiotikumok √∂sszefoglal√≥ t√°bl√°zata',
                'summary-table-desc': 'Csoportok szerinti √°ttekint√©s a f≈ëbb tulajdons√°gokkal',
                'th-group': 'Csoport',
                'th-effect': 'Hat√°s',
                'th-mechanism': 'Hat√°smechanizmus',
                'th-spectrum': 'Spektrum',
                'th-examples': 'P√©ld√°k', 
                'copyright': '¬© 2025, Dr. P√©terfi Zolt√°n | Verzi√≥: 4.3.6',
                'th-renal-antibiotic': 'Antibiotikum',
                'th-renal-gfr50': 'GFR > 50 ml/min',
                'th-renal-gfr10-50': 'GFR 10-50 ml/min',
                'th-renal-gfr30-50': 'GFR 30-50 ml/min',
                'th-renal-gfr10-29': 'GFR 10-29 ml/min',
                'th-renal-gfr-lt10': 'GFR < 10 ml/min',
                'th-renal-hd': 'HD',
                'search-renal-antibiotic': 'Keres√©s antibiotikum szerint:',
                'th-renal-crrt': 'CRRT',
                'export-renal-pdf-btn-text': 'PDF Ment√©s',
                'export-summary-pdf-btn-text': '√ñsszefoglal√≥ PDF',
                'export-detailed-pdf-btn-text': 'R√©szletes PDF',
                'export-diseases-pdf-btn-text': 'R√©szletes PDF',
                'export-pathogens-pdf-btn-text': 'R√©szletes PDF',
                'category': 'Kateg√≥ria',
                'commonPathogens': 'Gyakori k√≥rokoz√≥k',
                'empiricalTherapy': 'Empirikus ter√°pia',
                'firstLine': 'Els≈ë vonalbeli',
                'alternative': 'Alternat√≠va',
                'duration': 'Id≈ëtartam',
                'identifiers': 'Azonos√≠t√≥k',
                'type': 'T√≠pus',
                'morphology': 'Morfol√≥gia',
                'characteristics': 'Jellemz≈ëk',
                'commonInfections': 'Gyakori fert≈ëz√©sek',
                'therapy': 'Ter√°pia',
                'firstChoice': 'Els≈ë v√°laszt√°s',
                'resistant': 'Rezisztens',
                'targetedTherapy': 'C√©lzott ter√°pia',
                'notes': 'Megjegyz√©sek',
                'basicData': 'Alapadatok',
                'group': 'Csoport',
                'subgroup': 'Alcsoport',
                'effect': 'Hat√°s',
                'halfLife': 'Felez√©si id≈ë',
                'pae': 'PAE',
                'mechanism': 'Hat√°smechanizmus',
                'dosage': 'Adagol√°s',
                'standard': 'Standard',
                'high': 'Emelt d√≥zis',
                'oral': 'Or√°lis',
                'routes': 'Alkalmaz√°si m√≥dok',
                'spectrum': 'Spektrum',
                'gramPositive': 'Gram-pozit√≠v',
                'gramNegative': 'Gram-negat√≠v',
                'anaerobe': 'Anaerob',
                'atypical': 'Atypusos',
                'pseudomonas': 'Pseudomonas',
                'other': 'Egy√©b',
                'sideEffects': 'Mell√©khat√°sok',
                'question': 'K√©rd√©s',
                'of': '/',
                'score': 'Pontsz√°m',
                'next-btn': 'K√∂vetkez≈ë',
                'results-title': 'Eredm√©ny',
                'score-text': 'a pontsz√°mod',
                'restart-quiz-btn': '√öj kv√≠z',
                'correct-answer': 'Helyes!',
                'wrong-answer': 'Hib√°s! A helyes v√°lasz:',
                'tab-details': 'R√©szletek',
                'tab-pediatric': 'Gyermekd√≥zisok',
                // Pediatric dose keys - HU
                'neonate': '√öjsz√ºl√∂tt',
                'infant_child': 'Csecsem≈ë/Gyermek',
                'severe_infection': 'S√∫lyos fert≈ëz√©s',
                'child': 'Gyermek',
                'max_dose': 'Max. d√≥zis',
                'special': 'Speci√°lis',
                'notes': 'Megjegyz√©s',
                'high_dose': 'Emelt d√≥zis',
                'meningitis': 'Meningitis',
                'child_po': 'Gyermek (PO)',
                'child_iv': 'Gyermek (IV)',
                'contraindication': 'Ellenjavallat',
                'adolescent': 'Serd√ºl≈ë',
                'conventional': 'Hagyom√°nyos',
                'extended_interval': 'Kiterjesztett intervallum',
                'child_6m_5y': 'Gyermek (6h√≥ - 5√©v)',
                'child_5y_16y': 'Gyermek (5 - 16√©v)',
                'loading': 'Tel√≠t≈ë d√≥zis',
                'maintenance': 'Fenntart√≥ d√≥zis',
                'child_1y_6y': '1-6 √©v',
                'child_7y_11y': '7-11 √©v',
                'child_12y_17y': '12-17 √©v',
                'pcp_treatment': 'PCP kezel√©s',
                'child_gt_8y': 'Gyermek >8 √©v',
                'child_8y_11y': 'Gyermek (8-11 √©v)',
                'adolescent_12y_17y': 'Serd√ºl≈ë (12-17 √©v)',
                'inhalation_cf': 'Inhal√°ci√≥s (CF)',
                'iv': 'IV',
                'cystitis_po': 'Cystitis (PO)',
                'prophylaxis': 'Profilaxis',
                'child_2y_12y_iv': 'Gyermek (2-12 √©v) IV',
                'child_2y_12y_po': 'Gyermek (2-12 √©v) PO',
                'child_3m_17y': 'Gyermek (3h√≥ - 17√©v)',
                'liposomal': 'Liposz√≥m√°s',
                'deoxycholate': 'Deoxikol√°t',
                'tab-sensitivity': '√ârz√©keny bakt√©riumok',
                'no-sensitive-data': 'Nincs adat √©rz√©keny bakt√©riumokr√≥l.',
                'tab-sensitivity-micro': '√ârz√©kenys√©g',
                'no-antibiotic-data': 'Nincs adat √©rz√©keny antibiotikumokr√≥l.',
                'relevantAntibioticsInfo': 'Relev√°ns antibiotikum inform√°ci√≥k'
            },
            en: {
                'select-module': 'Select Module',
                'pharm-title': 'Pharmacological Approach',
                'pharm-desc': 'Antibiotic properties and mechanisms of action',
                'clin-title': 'Clinical Approach',
                'clin-desc': 'Diseases and therapeutic protocols',
                'micro-title': 'Microbiological Approach',
                'micro-desc': 'Pathogens and sensitivity spectrum',
                'summary-title': 'Summary Tables',
                'summary-desc': 'Overview table of antibiotic properties',
                'renal-title': 'Renal Impairment',
                'renal-desc': 'Dosage adjustment in renal impairment',
                'quiz-title': 'Quiz',
                'quiz-desc': 'Test your knowledge with interactive quizzes',
                'tdm-title': 'TDM Calculator',
                'tdm-desc': 'Gentamicin, Amikacin, Vancomycin, Voriconazole TDM',
                'renal-module-title': 'Dosage in Renal Impairment',
                'sensitivity-title': 'Sensitivity Spectrum',
                'sensitivity-desc': 'Antibiotic and bacterial sensitivity data',
                'sensitivity-module-title': 'Sensitivity Spectrum',
                'search-sensitivity-label': 'Search:',
                'sensitivity-mode-label': 'Search Mode:',
                'mode-antibiotic': 'By Antibiotic',
                'mode-bacteria': 'By Bacteria',
                'sensitivity-legend': 'Legend: S - Sensitive, I - Intermediate, R - Resistant',
                'pediatric-table-title': 'Antibiotic Dosages in Childhood',
                'pediatric-table-desc': 'General guidelines. Medical validation is always required!',
                'search-pediatric-antibiotic': 'Search by antibiotic:',
                'pediatric-title': 'Pediatric Doses',
                'pediatric-desc': 'Antibiotic dosages in childhood',
                'pediatric-module-title': 'Pediatric Doses',
                'renal-table-title': 'Antibiotic Doses by Renal Function',
                'quiz-module-title': 'Quiz',
                'quiz-setup-title': 'Quiz Settings',
                'quiz-topic-label': 'Topic:',
                'topic-pharm': 'Pharmacological',
                'topic-clin': 'Clinical',
                'topic-micro': 'Microbiological',
                'quiz-questions-label': 'Number of questions:',
                'quiz-difficulty-label': 'Difficulty:',
                'difficulty-easy': 'Easy',
                'difficulty-hard': 'Hard',
                'difficulty-auto': 'Automatic',
                'start-quiz-btn': 'Start Quiz',
                'pharm-module-title': 'Pharmacological Approach',
                'clin-module-title': 'Clinical Approach',
                'micro-module-title': 'Microbiological Approach',
                'summary-module-title': 'Summary Tables',
                'back-btn': 'Back',
                'search-name': 'Search by name:',
                'search-disease': 'Search by disease:',
                'back-btn-9': 'Back',
                'search-pathogen': 'Search by pathogen:',
                'filter-group': 'Filter by group:',
                'filter-system': 'Filter by organ system:',
                'filter-type': 'Filter by type:',
                'all-groups': 'All groups',
                'all-systems': 'All organ systems',
                'all-types': 'All types',
                'antibiotic-list': 'Antibiotic List',
                'disease-list': 'Disease List',
                'pathogen-list': 'Pathogen List',
                'select-antibiotic': 'Select an antibiotic to view details',
                'select-disease': 'Select a disease to view details',
                'select-pathogen': 'Select a pathogen to view details',
                'summary-table-title': 'Antibiotic Summary Table',
                'summary-table-desc': 'Group-based overview with key properties',
                'th-group': 'Group',
                'th-effect': 'Effect',
                'th-mechanism': 'Mechanism',
                'th-spectrum': 'Spectrum',
                'th-examples': 'Examples', 
                'copyright': '¬© 2025, Dr. P√©terfi Zolt√°n | Version: 4.3.6',
                'th-renal-antibiotic': 'Antibiotic',
                'th-renal-gfr50': 'GFR > 50 ml/min',
                'th-renal-gfr10-50': 'GFR 10-50 ml/min',
                'th-renal-gfr30-50': 'GFR 30-50 ml/min',
                'th-renal-gfr10-29': 'GFR 10-29 ml/min',
                'th-renal-gfr-lt10': 'GFR < 10 ml/min',
                'th-renal-hd': 'HD',
                'search-renal-antibiotic': 'Search by antibiotic:',
                'th-renal-crrt': 'CRRT',
                'export-renal-pdf-btn-text': 'Save PDF',
                'export-summary-pdf-btn-text': 'Summary PDF',
                'export-detailed-pdf-btn-text': 'Detailed PDF',
                'export-diseases-pdf-btn-text': 'Detailed PDF',
                'export-pathogens-pdf-btn-text': 'Detailed PDF',
                'category': 'Category',
                'commonPathogens': 'Common Pathogens',
                'empiricalTherapy': 'Empirical Therapy',
                'firstLine': 'First Line',
                'alternative': 'Alternative',
                'duration': 'Duration',
                'identifiers': 'Identifiers',
                'type': 'Type',
                'morphology': 'Morphology',
                'characteristics': 'Characteristics',
                'commonInfections': 'Common Infections',
                'therapy': 'Therapy',
                'firstChoice': 'First Choice',
                'resistant': 'Resistant',
                'targetedTherapy': 'Targeted Therapy',
                'notes': 'Notes',
                'basicData': 'Basic Data',
                'group': 'Group',
                'subgroup': 'Subgroup',
                'effect': 'Effect',
                'halfLife': 'Half-life',
                'pae': 'PAE',
                'mechanism': 'Mechanism of Action',
                'dosage': 'Dosage',
                'standard': 'Standard',
                'high': 'High Dose',
                'oral': 'Oral',
                'routes': 'Routes of Administration',
                'spectrum': 'Spectrum',
                'gramPositive': 'Gram-positive',
                'gramNegative': 'Gram-negative',
                'anaerobe': 'Anaerobe',
                'atypical': 'Atypical',
                'pseudomonas': 'Pseudomonas',
                'other': 'Other',
                'sideEffects': 'Side Effects',
                'question': 'Question',
                'of': 'of',
                'score': 'Score',
                'next-btn': 'Next',
                'results-title': 'Results',
                'score-text': 'is your score.',
                'restart-quiz-btn': 'New Quiz',
                'correct-answer': 'Correct!',
                'wrong-answer': 'Wrong! The correct answer was:',
                'tab-details': 'Details',
                'tab-pediatric': 'Pediatric Doses',
                // Pediatric dose keys - EN
                'neonate': 'Neonate',
                'infant_child': 'Infant/Child',
                'severe_infection': 'Severe Infection',
                'child': 'Child',
                'max_dose': 'Max Dose',
                'special': 'Special',
                'notes': 'Notes',
                'high_dose': 'High Dose',
                'meningitis': 'Meningitis',
                'child_po': 'Child (PO)',
                'child_iv': 'Child (IV)',
                'contraindication': 'Contraindication',
                'adolescent': 'Adolescent',
                'conventional': 'Conventional',
                'extended_interval': 'Extended Interval',
                'child_6m_5y': 'Child (6m - 5y)',
                'child_5y_16y': 'Child (5 - 16y)',
                'loading': 'Loading Dose',
                'maintenance': 'Maintenance Dose',
                'child_1y_6y': '1-6 years',
                'child_7y_11y': '7-11 years',
                'child_12y_17y': '12-17 years',
                'pcp_treatment': 'PCP Treatment',
                'child_gt_8y': 'Child >8 years',
                'child_8y_11y': 'Child (8-11 years)',
                'adolescent_12y_17y': 'Adolescent (12-17 years)',
                'inhalation_cf': 'Inhalation (CF)',
                'iv': 'IV',
                'cystitis_po': 'Cystitis (PO)',
                'prophylaxis': 'Prophylaxis',
                'child_2y_12y_iv': 'Child (2-12y) IV',
                'child_2y_12y_po': 'Child (2-12y) PO',
                'child_3m_17y': 'Child (3m - 17y)',
                'liposomal': 'Liposomal',
                'deoxycholate': 'Deoxycholate',
                'tab-sensitivity': 'Sensitive Bacteria',
                'no-sensitive-data': 'No data on sensitive bacteria.',
                'tab-sensitivity-micro': 'Sensitivity',
                'no-antibiotic-data': 'No data on sensitive antibiotics.',
                'relevantAntibioticsInfo': 'Relevant Antibiotic Information'
            },
            de: {
                'select-module': 'Modul ausw√§hlen',
                'pharm-title': 'Pharmakologischer Ansatz',
                'pharm-desc': 'Antibiotika-Eigenschaften und Wirkmechanismen',
                'clin-title': 'Klinischer Ansatz',
                'clin-desc': 'Krankheiten und therapeutische Protokolle',
                'micro-title': 'Mikrobiologischer Ansatz',
                'micro-desc': 'Erreger und Empfindlichkeitsspektrum',
                'summary-title': 'Zusammenfassungstabellen',
                'summary-desc': '√úbersichtstabelle der Antibiotika-Eigenschaften',
                'renal-title': 'Niereninsuffizienz',
                'renal-desc': 'Dosisanpassung bei Niereninsuffizienz',
                'renal-module-title': 'Dosisanpassung bei Niereninsuffizienz',
                'renal-table-title': 'Antibiotikadosen nach Nierenfunktion',
                'quiz-title': 'Quiz',
                'quiz-desc': 'Testen Sie Ihr Wissen mit interaktiven Quizfragen',
                'tdm-title': 'TDM-Rechner',
                'tdm-desc': 'Gentamicin, Amikacin, Vancomycin, Voriconazol TDM',
                'quiz-module-title': 'Quiz',
                'sensitivity-title': 'Empfindlichkeitsspektrum',
                'sensitivity-desc': 'Antibiotika- und Bakterienempfindlichkeitsdaten',
                'sensitivity-module-title': 'Empfindlichkeitsspektrum',
                'search-sensitivity-label': 'Suche:',
                'sensitivity-mode-label': 'Suchmodus:',
                'mode-antibiotic': 'Nach Antibiotikum',
                'mode-bacteria': 'Nach Bakterien',
                'sensitivity-legend': 'Legende: S - Empfindlich, I - M√§√üig empfindlich, R - Resistent',
                'quiz-setup-title': 'Quiz-Einstellungen',
                'quiz-topic-label': 'Thema:',
                'topic-pharm': 'Pharmakologisch',
                'topic-clin': 'Klinisch',
                'topic-micro': 'Mikrobiologisch',
                'quiz-questions-label': 'Anzahl der Fragen:',
                'quiz-difficulty-label': 'Schwierigkeit:',
                'difficulty-easy': 'Leicht',
                'difficulty-hard': 'Schwer',
                'difficulty-auto': 'Automatisch',
                'start-quiz-btn': 'Quiz starten',
                'pharm-module-title': 'Pharmakologischer Ansatz',
                'clin-module-title': 'Klinischer Ansatz',
                'micro-module-title': 'Mikrobiologischer Ansatz',
                'summary-module-title': 'Zusammenfassungstabellen',
                'back-btn': 'Zur√ºck',
                'search-name': 'Nach Name suchen:',
                'search-disease': 'Nach Krankheit suchen:',
                'back-btn-9': 'Zur√ºck',
                'search-pathogen': 'Nach Erreger suchen:',
                'filter-group': 'Nach Gruppe filtern:',
                'filter-system': 'Nach Organsystem filtern:',
                'filter-type': 'Nach Typ filtern:',
                'all-groups': 'Alle Gruppen',
                'all-systems': 'Alle Organsysteme',
                'all-types': 'Alle Typen',
                'antibiotic-list': 'Antibiotika-Liste',
                'disease-list': 'Krankheitsliste',
                'pathogen-list': 'Erregerliste',
                'select-antibiotic': 'W√§hlen Sie ein Antibiotikum f√ºr Details aus',
                'select-disease': 'W√§hlen Sie eine Krankheit f√ºr Details aus',
                'select-pathogen': 'W√§hlen Sie einen Erreger f√ºr Details aus',
                'summary-table-title': 'Antibiotika-Zusammenfassungstabelle',
                'summary-table-desc': 'Gruppenbasierte √úbersicht mit wichtigsten Eigenschaften',
                'th-group': 'Gruppe',
                'th-effect': 'Wirkung',
                'th-mechanism': 'Mechanismus',
                'th-spectrum': 'Spektrum',
                'th-examples': 'Beispiele', 
                'copyright': '¬© 2025, Dr. P√©terfi Zolt√°n | Version: 4.3.6',
                'th-renal-antibiotic': 'Antibiotikum',
                'th-renal-gfr50': 'GFR > 50 ml/min',
                'th-renal-gfr10-50': 'GFR 10-50 ml/min',
                'th-renal-gfr30-50': 'GFR 30-50 ml/min',
                'th-renal-gfr10-29': 'GFR 10-29 ml/min',
                'th-renal-gfr-lt10': 'GFR < 10 ml/min',
                'th-renal-hd': 'HD',
                'search-renal-antibiotic': 'Nach Antibiotikum suchen:',
                'th-renal-crrt': 'CRRT',
                'export-renal-pdf-btn-text': 'PDF Speichern',
                'export-summary-pdf-btn-text': 'Zusammenfassungs-PDF',
                'export-detailed-pdf-btn-text': 'Detailliertes PDF',
                'export-diseases-pdf-btn-text': 'Detailliertes PDF',
                'export-pathogens-pdf-btn-text': 'Detailliertes PDF',
                'category': 'Kategorie',
                'commonPathogens': 'H√§ufige Erreger',
                'empiricalTherapy': 'Empirische Therapie',
                'firstLine': 'Erste Wahl',
                'alternative': 'Alternative',
                'duration': 'Dauer',
                'identifiers': 'Identifikatoren',
                'type': 'Typ',
                'morphology': 'Morphologie',
                'characteristics': 'Eigenschaften',
                'commonInfections': 'H√§ufige Infektionen',
                'therapy': 'Therapie',
                'firstChoice': 'Erste Wahl',
                'resistant': 'Resistent',
                'targetedTherapy': 'Gezielte Therapie',
                'notes': 'Anmerkungen',
                'basicData': 'Grunddaten',
                'group': 'Gruppe',
                'subgroup': 'Untergruppe',
                'effect': 'Wirkung',
                'halfLife': 'Halbwertszeit',
                'pae': 'PAE',
                'mechanism': 'Wirkmechanismus',
                'dosage': 'Dosierung',
                'standard': 'Standard',
                'high': 'Hohe Dosis',
                'oral': 'Oral',
                'routes': 'Verabreichungswege',
                'spectrum': 'Spektrum',
                'gramPositive': 'Gram-positiv',
                'gramNegative': 'Gram-negativ',
                'anaerobe': 'Anaerobier',
                'atypical': 'Atypisch',
                'pseudomonas': 'Pseudomonas',
                'other': 'Andere',
                'sideEffects': 'Nebenwirkungen',
                'question': 'Frage',
                'of': 'von',
                'score': 'Punktestand',
                'next-btn': 'N√§chste',
                'results-title': 'Ergebnisse',
                'score-text': 'ist Ihre Punktzahl.',
                'restart-quiz-btn': 'Neues Quiz',
                'correct-answer': 'Richtig!',
                'wrong-answer': 'Falsch! Die richtige Antwort war:',
                'tab-details': 'Details',
                'tab-pediatric': 'P√§diatrische Dosen',
                // Pediatric dose keys - DE
                'neonate': 'Neugeborenes',
                'infant_child': 'S√§ugling/Kind',
                'severe_infection': 'Schwere Infektion',
                'child': 'Kind',
                'max_dose': 'Max. Dosis',
                'special': 'Speziell',
                'notes': 'Anmerkungen',
                'high_dose': 'Hohe Dosis',
                'meningitis': 'Meningitis',
                'child_po': 'Kind (p.o.)',
                'child_iv': 'Kind (i.v.)',
                'contraindication': 'Kontraindikation',
                'adolescent': 'Jugendlicher',
                'conventional': 'Konventionell',
                'extended_interval': 'Verl√§ngertes Intervall',
                'child_6m_5y': 'Kind (6M - 5J)',
                'child_5y_16y': 'Kind (5 - 16J)',
                'loading': 'Aufs√§ttigungsdosis',
                'maintenance': 'Erhaltungsdosis',
                'child_1y_6y': '1-6 Jahre',
                'child_7y_11y': '7-11 Jahre',
                'child_12y_17y': '12-17 Jahre',
                'pcp_treatment': 'PCP-Behandlung',
                'child_gt_8y': 'Kind >8 Jahre',
                'child_8y_11y': 'Kind (8-11 Jahre)',
                'adolescent_12y_17y': 'Jugendlicher (12-17 Jahre)',
                'inhalation_cf': 'Inhalation (CF)',
                'iv': 'i.v.',
                'cystitis_po': 'Zystitis (p.o.)',
                'prophylaxis': 'Prophylaxe',
                'child_2y_12y_iv': 'Kind (2-12J) i.v.',
                'child_2y_12y_po': 'Kind (2-12J) p.o.',
                'child_3m_17y': 'Kind (3M - 17J)',
                'liposomal': 'Liposomal',
                'deoxycholate': 'Deoxycholat',
                'tab-sensitivity': 'Empfindliche Bakterien',
                'no-sensitive-data': 'Keine Daten zu empfindlichen Bakterien.',
                'tab-sensitivity-micro': 'Empfindlichkeit',
                'no-antibiotic-data': 'Keine Daten zu empfindlichen Antibiotika.',
                'relevantAntibioticsInfo': 'Relevante Antibiotika-Informationen'
            }
        };

        function changeLanguage(lang) {
            currentLanguage = lang;
            
            document.querySelectorAll('[id^="lang-"]').forEach(btn => {
                btn.className = 'px-3 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors';
            });
            document.getElementById(`lang-${lang}`).className = 'px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors';
            
            Object.keys(translations[lang]).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = translations[lang][key];
                }
            });
            if (lang === 'hu') {
        antibiotics = window.antibiotics_hu || [];
        diseases = window.diseases_hu || [];
        pathogens = window.pathogens_hu || [];
        testQuestions = (window.test_hu || []).concat(window.test_new || []);
        renalDoses = window.renal_dose_hu || []; 
        pediatricDoses = window.pediatric_doses_hu || [];
    } else if (lang === 'en') {
        antibiotics = window.antibiotics_en || [];
        diseases = window.diseases_en || [];
        pathogens = window.pathogens_en || [];
        testQuestions = window.test_en || [];
        renalDoses = window.renal_dose_en || []; 
        pediatricDoses = window.pediatric_doses_en || [];
    } else if (lang === 'de') {
        antibiotics = window.antibiotics_de || [];
        diseases = window.diseases_de || [];
        pathogens = window.pathogens_de || [];
        testQuestions = window.test_de || [];
        renalDoses = window.renal_dose_de || []; 
        pediatricDoses = window.pediatric_doses_de || [];
    }

            document.getElementById('back-btn-2').textContent = translations[lang]['back-btn'];
            document.getElementById('back-btn-3').textContent = translations[lang]['back-btn'];
            document.getElementById('back-btn-4').textContent = translations[lang]['back-btn'];
            document.getElementById('back-btn-5').textContent = translations[lang]['back-btn'];
            document.getElementById('back-btn-6').textContent = translations[lang]['back-btn'];
            document.getElementById('back-btn-8').textContent = translations[lang]['back-btn'];
            document.getElementById('back-btn-9').textContent = translations[lang]['back-btn'];
            document.getElementById('installPrompt').textContent = translations[lang]['install-prompt'] || 'üì± Install';
            document.getElementById('footer-copyright').textContent = translations[lang]['copyright'];
            
            refreshCurrentModule();
        }

        function showModule(moduleType) {

            document.getElementById('module-selection').classList.add('hidden');
            document.getElementById(`${moduleType}-module`).classList.remove('hidden');
            
            if (moduleType === 'pharmacological') {
                initPharmacologicalModule();
            } else if (moduleType === 'clinical') {
                initClinicalModule();
            } else if (moduleType === 'microbiological') {
                initMicrobiologicalModule();
            } else if (moduleType === 'summary') {
                initSummaryModule();
            } else if (moduleType === 'quiz') {
                initQuizModule();
            } else if (moduleType === 'renal') {
                initRenalModule();
            } else if (moduleType === 'pediatric') {
                initPediatricModule();
            }
            else if (moduleType === 'sensitivity') {
                initSensitivityModule();
            }
             else if (moduleType === 'tdm') {
                initTdmModule();
            }
        }

        function showModuleSelection() {
            document.querySelectorAll('[id$="-module"]').forEach(module => {
                module.classList.add('hidden');
            });
            document.getElementById('module-selection').classList.remove('hidden');
        }

        function initPharmacologicalModule() {
            populatePharmGroups();
            displayPharmList(antibiotics);
            setupPharmSearch();
        }

        function initClinicalModule() {
            populateClinCategories();
            displayClinList(diseases);
            setupClinSearch();
        }

        function initMicrobiologicalModule() {
            populateMicroTypes();
            displayMicroList(pathogens);
            setupMicroSearch();
        }

        function initSummaryModule() {
            generateSummaryTable();
        }

        function initQuizModule() {
            // The setup screen is shown by default, nothing else to do here.
        }

        function initRenalModule() {
            displayRenalDoseTable(renalDoses);
            setupRenalSearch();
        }

        function initPediatricModule() {
            displayPediatricDoseTable(pediatricDoses);
            setupPediatricSearch();
        }

        function initTdmModule() {
            // The HTML is now embedded, so just initialize the state
            updateDrugInfo();
            setupTdmInputValidation();
        }


        function populatePharmGroups() {
            const groupFilter = document.getElementById('pharm-group-filter');
            const groups = [...new Set(antibiotics.map(ab => ab.group[currentLanguage]))];
            
            groupFilter.innerHTML = `<option value="">${translations[currentLanguage]['all-groups']}</option>`;
            groups.sort().forEach(group => {
                groupFilter.innerHTML += `<option value="${group}">${group}</option>`;
            });
        }

        function populateClinCategories() {
            const categoryFilter = document.getElementById('clin-category-filter');
            
            const currentValue = categoryFilter.value;

            while (categoryFilter.options.length > 1) {
                categoryFilter.remove(1);
            }

            const categories = [...new Set(diseases.map(d => d.category))];
            
            const categoryTranslations = {
                "CNS": { hu: "K√∂zponti idegrendszer", en: "Central Nervous System", de: "Zentralnervensystem" },
                "Respiratory": { hu: "L√©gz≈ërendszer", en: "Respiratory System", de: "Atmungssystem" },
                "Cardiovascular": { hu: "Sz√≠v- √©s √©rrendszer", en: "Cardiovascular System", de: "Herz-Kreislauf-System" },
                "Urogenital": { hu: "Urogenit√°lis rendszer", en: "Urogenital System", de: "Urogenitalsystem" },
                "Skin": { hu: "B≈ër √©s l√°gyr√©szek", en: "Skin and Soft Tissues", de: "Haut und Weichteile" },
                "Sepsis": { hu: "Szepszis", en: "Sepsis", de: "Sepsis" },
                "Gastrointestinal": { hu: "Gastrointestin√°lis rendszer", en: "Gastrointestinal System", de: "Magen-Darm-System" },
                "Orthopedic": { hu: "Ortop√©diai", en: "Orthopedic", de: "Orthop√§disch" }
            };

            categories.sort((a, b) => (categoryTranslations[a] ? categoryTranslations[a][currentLanguage] : a).localeCompare(categoryTranslations[b] ? categoryTranslations[b][currentLanguage] : b));

            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = categoryTranslations[category] ? categoryTranslations[category][currentLanguage] : category;
                option.dataset.key = category;
                categoryFilter.appendChild(option);
            });

            categoryFilter.value = currentValue;
        }

        function populateMicroTypes() {
            const typeFilter = document.getElementById('micro-type-filter');
            const types = [...new Set(pathogens.map(p => p.type[currentLanguage]))];
            
            typeFilter.innerHTML = `<option value="">${translations[currentLanguage]['all-types']}</option>`;
            types.sort().forEach(type => {
                typeFilter.innerHTML += `<option value="${type}">${type}</option>`;
            });
        }

        function displayPharmList(list) {
            const pharmList = document.getElementById('pharm-list');
            pharmList.innerHTML = '';
            if (!list) return;
            list.sort((a, b) => a.name[currentLanguage].localeCompare(b.name[currentLanguage]));
            list.forEach(ab => {
                const div = document.createElement('div');
                div.innerHTML = `<span class="font-medium">${ab.name[currentLanguage]}</span>${ab.group.abbreviation ? `<span class="text-xs text-gray-400 ml-2">${ab.group.abbreviation}</span>` : ''}`;
                div.className = 'px-3 py-2 cursor-pointer hover:bg-blue-50 hover:text-blue-700 rounded-md text-sm transition-colors duration-150 flex items-center justify-between border border-transparent hover:border-blue-100';
                div.onclick = () => showPharmDetails(ab);
                pharmList.appendChild(div);
            });
        }

        function displayClinList(list) {
            const clinList = document.getElementById('clin-list');
            clinList.innerHTML = '';
            if (!list) return;
            list.sort((a, b) => a.name[currentLanguage].localeCompare(b.name[currentLanguage]));
            list.forEach(disease => {
                const severityIcons = {
                    'high': '<span class="text-red-500" title="Emelt s√∫lyoss√°g">üî¥</span>',
                    'medium': '<span class="text-yellow-500" title="K√∂zepes s√∫lyoss√°g">üü°</span>',
                    'low': '<span class="text-green-500" title="Alacsony s√∫lyoss√°g">üü¢</span>'
                };
                const severityTooltips = {
                    'high': { hu: 'Emelt s√∫lyoss√°g', en: 'High Severity', de: 'Hohe Schweregrad' },
                    'medium': { hu: 'K√∂zepes s√∫lyoss√°g', en: 'Medium Severity', de: 'Mittlerer Schweregrad' },
                    'low': { hu: 'Alacsony s√∫lyoss√°g', en: 'Low Severity', de: 'Niedriger Schweregrad' }
                };
                const icon = severityIcons[disease.severity] ? `<span class="text-lg mr-2" title="${severityTooltips[disease.severity] ? severityTooltips[disease.severity][currentLanguage] : ''}">${severityIcons[disease.severity]}</span>` : '<span class="inline-block w-6 mr-2"></span>';

                const div = document.createElement('div');
                div.innerHTML = `<div class="flex items-center">${icon}<span class="font-medium">${disease.name[currentLanguage]}</span></div>`;
                div.className = 'px-3 py-2 cursor-pointer hover:bg-green-50 hover:text-green-700 rounded-md text-sm transition-colors duration-150 flex items-center justify-between border border-transparent hover:border-green-100';
                div.onclick = () => showClinDetails(disease);
                clinList.appendChild(div);
            });
        }

        function displayMicroList(list) {
            const microList = document.getElementById('micro-list');
            microList.innerHTML = '';
            if (!list) return;
            list.sort((a, b) => a.name.localeCompare(b.name));
            list.forEach(p => {
                let dotClass = 'bg-gray-300';
                const typeEn = p.type && p.type.en ? p.type.en.toLowerCase() : '';
                const typeHu = p.type && p.type.hu ? p.type.hu.toLowerCase() : '';
                
                if (typeEn.includes('gram-positive') || typeHu.includes('gram-pozit√≠v')) {
                    dotClass = 'bg-purple-700';
                } else if (typeEn.includes('gram-negative') || typeHu.includes('gram-negat√≠v')) {
                    dotClass = 'bg-pink-500';
                }

                const div = document.createElement('div');
                div.innerHTML = `<span class="w-3 h-3 rounded-full ${dotClass} mr-2 flex-shrink-0" title="${p.type[currentLanguage]}"></span><i>${p.name}</i>`;
                div.className = 'p-2 cursor-pointer hover:bg-purple-100 rounded flex items-center';
                div.onclick = () => showMicroDetails(p);
                microList.appendChild(div);
            });
        }

        function showPharmDetails(antibiotic) {
            const details = document.getElementById('pharm-details');
            const lang = currentLanguage;
            
            const spectrumIcons = {
                gramPos: antibiotic.spectrum.gramPos ? '<span class="text-green-600">‚úÖ</span>' : '<span class="text-gray-300">‚ùå</span>',
                gramNeg: antibiotic.spectrum.gramNeg ? '<span class="text-green-600">‚úÖ</span>' : '<span class="text-gray-300">‚ùå</span>',
                anaerob: antibiotic.spectrum.anaerob ? '<span class="text-green-600">‚úÖ</span>' : '<span class="text-gray-300">‚ùå</span>',
                atypical: antibiotic.spectrum.atypical ? '<span class="text-green-600">‚úÖ</span>' : '<span class="text-gray-300">‚ùå</span>',
                pseudomonas: antibiotic.spectrum.pseudomonas ? '<span class="text-green-600">‚úÖ</span>' : '<span class="text-gray-300">‚ùå</span>'
            };
            
            const effectColor = (antibiotic.effect[lang] || '').toLowerCase().includes('bactericid') || (antibiotic.effect[lang] || '').toLowerCase().includes('bakterizid') ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800';

            details.innerHTML = `
                <div class="text-left h-full flex flex-col">
                    <!-- Header Section -->
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 gap-2">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                                ${antibiotic.name[lang]} 
                                <span class="text-lg font-normal text-gray-500">${antibiotic.group.abbreviation ? `(${antibiotic.group.abbreviation})` : ''}</span>
                            </h3>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <span class="px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800 border border-gray-200">${antibiotic.group[lang]}</span>
                                ${antibiotic.subgroup ? `<span class="px-2 py-0.5 rounded text-xs font-medium bg-gray-50 text-gray-600 border border-gray-200">${antibiotic.subgroup[lang]}</span>` : ''}
                                <span class="px-2 py-0.5 rounded text-xs font-medium ${effectColor}">${antibiotic.effect[lang]}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="mb-4 border-b border-gray-200">
                        <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                            <a href="#" onclick="switchPharmTab(event, 'details')" class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm border-indigo-500 text-indigo-600 transition-colors" id="tab-details">${translations[lang]['tab-details']}</a>
                            <a href="#" onclick="switchPharmTab(event, 'pediatric')" class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 transition-colors" id="tab-pediatric">${translations[lang]['tab-pediatric']}</a>
                            <a href="#" onclick="switchPharmTab(event, 'sensitivity')" class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 transition-colors" id="tab-sensitivity">${translations[lang]['tab-sensitivity']}</a>
                        </nav>
                    </div>

                    <!-- Content Area -->
                    <div class="flex-grow overflow-y-auto pr-1 custom-scrollbar">
                        
                        <!-- Pediatric Tab -->
                        <div id="pharm-tab-content-pediatric" class="hidden animate-fade-in">
                            <div class="bg-pink-50 border border-pink-100 p-4 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-pink-800 mb-3 flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    Gyermekd√≥zisok
                                </h4>
                                <div id="pediatric-dose-info" class="text-sm text-gray-700"></div>
                            </div>
                        </div>

                        <!-- Sensitivity Tab -->
                        <div id="pharm-tab-content-sensitivity" class="hidden animate-fade-in">
                            <div class="bg-teal-50 border border-teal-100 p-4 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-teal-800 mb-3 flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    ${translations[lang]['tab-sensitivity']}
                                </h4>
                                <div id="sensitivity-info" class="text-sm text-gray-700"></div>
                            </div>
                        </div>
                        
                        <!-- Details Tab (Main) -->
                        <div id="pharm-tab-content-details" class="grid lg:grid-cols-2 gap-4 animate-fade-in">
                            
                            <!-- Left Column: PK & Dosage -->
                            <div class="space-y-4">
                                <!-- PK Card -->
                                <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                    <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 border-b border-gray-100 pb-1">${translations[lang]['basicData']}</h4>
                                    <div class="grid grid-cols-2 gap-y-3 gap-x-2 text-sm">
                                        <div>
                                            <span class="block text-xs text-gray-500">${translations[lang]['halfLife']}</span>
                                            <span class="font-medium text-gray-800">${antibiotic.halfLife[lang]}</span>
                                        </div>
                                        <div>
                                            <span class="block text-xs text-gray-500">${translations[lang]['pae']}</span>
                                            <span class="font-medium text-gray-800">${antibiotic.pae[lang]}</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Dosage Card -->
                                <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                    <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 border-b border-gray-100 pb-1">${translations[lang]['dosage']}</h4>
                                    <div class="space-y-3 text-sm">
                                        <div class="flex justify-between items-baseline border-b border-gray-50 pb-1">
                                            <span class="text-gray-500 w-1/3">${translations[lang]['standard']}</span>
                                            <span class="font-medium text-gray-800 w-2/3 text-right">${antibiotic.dosage.standard[lang]}</span>
                                        </div>
                                        <div class="flex justify-between items-baseline border-b border-gray-50 pb-1">
                                            <span class="text-gray-500 w-1/3">${translations[lang]['high']}</span>
                                            <span class="font-medium text-gray-800 w-2/3 text-right">${antibiotic.dosage.high[lang]}</span>
                                        </div>
                                        <div class="flex justify-between items-baseline border-b border-gray-50 pb-1">
                                            <span class="text-gray-500 w-1/3">${translations[lang]['oral']}</span>
                                            <span class="font-medium text-gray-800 w-2/3 text-right">${antibiotic.dosage.oral[lang]}</span>
                                        </div>
                                        <div class="pt-1">
                                            <span class="block text-xs text-gray-500 mb-1">${translations[lang]['routes']}</span>
                                            <div class="flex flex-wrap gap-1">
                                                ${antibiotic.routes.map(r => `<span class="px-2 py-0.5 bg-gray-100 text-gray-600 rounded text-xs border border-gray-200">${r}</span>`).join('')}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right Column: Mechanism, Spectrum, Side Effects -->
                            <div class="space-y-4">
                                <!-- Mechanism -->
                                <div class="bg-green-50 border border-green-100 rounded-lg p-3 shadow-sm">
                                    <h4 class="text-xs font-bold text-green-800 uppercase tracking-wider mb-1">${translations[lang]['mechanism']}</h4>
                                    <p class="text-sm text-green-900 leading-relaxed">${antibiotic.mechanism[lang]}</p>
                                </div>

                                <!-- Spectrum -->
                                <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                    <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 border-b border-gray-100 pb-1">${translations[lang]['spectrum']}</h4>
                                    <div class="grid grid-cols-2 gap-2 text-sm">
                                        <div class="flex items-center justify-between p-1.5 bg-gray-50 rounded">
                                            <span class="text-gray-600">${translations[lang]['gramPositive']}</span>
                                            ${spectrumIcons.gramPos}
                                        </div>
                                        <div class="flex items-center justify-between p-1.5 bg-gray-50 rounded">
                                            <span class="text-gray-600">${translations[lang]['gramNegative']}</span>
                                            ${spectrumIcons.gramNeg}
                                        </div>
                                        <div class="flex items-center justify-between p-1.5 bg-gray-50 rounded">
                                            <span class="text-gray-600">${translations[lang]['anaerobe']}</span>
                                            ${spectrumIcons.anaerob}
                                        </div>
                                        <div class="flex items-center justify-between p-1.5 bg-gray-50 rounded">
                                            <span class="text-gray-600">${translations[lang]['atypical']}</span>
                                            ${spectrumIcons.atypical}
                                        </div>
                                        <div class="flex items-center justify-between p-1.5 bg-gray-50 rounded col-span-2">
                                            <span class="text-gray-600">${translations[lang]['pseudomonas']}</span>
                                            ${spectrumIcons.pseudomonas}
                                        </div>
                                    </div>
                                    ${antibiotic.spectrum.other[lang] ? `<div class="mt-2 text-xs text-gray-500 border-t border-gray-100 pt-2"><strong>${translations[lang]['other']}:</strong> ${antibiotic.spectrum.other[lang]}</div>` : ''}
                                </div>
                                
                                <!-- Side Effects -->
                                <div class="bg-red-50 border border-red-100 rounded-lg p-3 shadow-sm">
                                    <h4 class="text-xs font-bold text-red-800 uppercase tracking-wider mb-1">${translations[lang]['sideEffects']}</h4>
                                    <p class="text-sm text-red-900 leading-relaxed">${antibiotic.sideEffects[lang]}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Gyermekd√≥zis bet√∂lt√©se
            const pediatricDoseInfo = document.getElementById('pediatric-dose-info');
            if (pediatricDoses && pediatricDoses.length > 0) {
                const pediatricDose = pediatricDoses.find(pd => pd.antibiotic_name === antibiotic.name.en);
                if (pediatricDose) {
                    let doseHtml = '<ul class="list-disc list-inside space-y-1">';
                    for (const [key, value] of Object.entries(pediatricDose.doses)) {
                        const translatedKey = translations[lang][key] || key.replace(/_/g, ' ');
                        doseHtml += `<li><strong class="capitalize">${translatedKey}:</strong> ${value}</li>`;
                    }
                    pediatricDoseInfo.innerHTML = doseHtml + '</ul>';
                } else {
                    pediatricDoseInfo.innerHTML = `<p>Nincs el√©rhet≈ë gyermekd√≥zis adat.</p>`;
                }
            } else {
                 pediatricDoseInfo.innerHTML = `<p>${translations[lang]['no-data'] || 'Pediatric dose data not available for this language.'}</p>`;
            }

            // √ârz√©kenys√©gi adatok bet√∂lt√©se
            const sensitivityInfo = document.getElementById('sensitivity-info');
            if (typeof antibioticSpectrumData !== 'undefined') {
                const names = [antibiotic.name.en, antibiotic.name.hu, antibiotic.name.de].filter(Boolean);
                let foundKey = null;
                
                for (const name of names) {
                    const key = Object.keys(antibioticSpectrumData).find(k => k.toLowerCase() === name.toLowerCase());
                    if (key) {
                        foundKey = key;
                        break;
                    }
                }

                if (foundKey) {
                    const data = antibioticSpectrumData[foundKey];
                    const sensitiveBacteria = data.filter(item => item.sensitivity === 'S');
                    
                    if (sensitiveBacteria.length > 0) {
                        let html = '<ul class="list-disc list-inside space-y-1">';
                        sensitiveBacteria.forEach(item => {
                             let content = `${item.bacteria} <span class="text-xs text-gray-500">(${item.original})</span>`;
                             if (item.resistance) {
                                 content += ` <span class="text-xs text-red-600 font-semibold ml-1">R: ${item.resistance}</span>`;
                             }
                             html += `<li>${content}</li>`;
                        });
                        html += '</ul>';
                        sensitivityInfo.innerHTML = html;
                    } else {
                         sensitivityInfo.innerHTML = `<p>${translations[lang]['no-sensitive-data']}</p>`;
                    }
                } else {
                    sensitivityInfo.innerHTML = `<p>${translations[lang]['no-data'] || 'Nincs el√©rhet≈ë adat.'}</p>`;
                }
            }
        }

        function switchPharmTab(event, tabName) {
            event.preventDefault();
            // Tabok elrejt√©se
            document.getElementById('pharm-tab-content-details').classList.add('hidden');
            document.getElementById('pharm-tab-content-pediatric').classList.add('hidden');
            document.getElementById('pharm-tab-content-sensitivity').classList.add('hidden');

            // Linkek st√≠lus√°nak resetel√©se
            document.getElementById('tab-details').className = 'whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 transition-colors';
            document.getElementById('tab-pediatric').className = 'whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 transition-colors';
            document.getElementById('tab-sensitivity').className = 'whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 transition-colors';

            // Akt√≠v tab √©s tartalom megjelen√≠t√©se
            document.getElementById(`pharm-tab-content-${tabName}`).classList.remove('hidden');
            document.getElementById(`tab-${tabName}`).className = 'whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm border-indigo-500 text-indigo-600 transition-colors';
        }

        function showClinDetails(disease) {
            const detailsView = document.getElementById('clin-details');
            detailsView.classList.remove('text-center');
            const lang = currentLanguage;

            const categoryTranslations = {
                "CNS": { hu: "K√∂zponti idegrendszer", en: "Central Nervous System", de: "Zentralnervensystem" },
                "Respiratory": { hu: "L√©gz≈ërendszer", en: "Respiratory System", de: "Atmungssystem" },
                "Cardiovascular": { hu: "Sz√≠v- √©s √©rrendszer", en: "Cardiovascular System", de: "Herz-Kreislauf-System" },
                "Urogenital": { hu: "Urogenit√°lis rendszer", en: "Urogenital System", de: "Urogenitalsystem" },
                "Skin": { hu: "B≈ër √©s l√°gyr√©szek", en: "Skin and Soft Tissues", de: "Haut und Weichteile" },
                "Sepsis": { hu: "Szepszis", en: "Sepsis", de: "Sepsis" },
                "Gastrointestinal": { hu: "Gastrointestin√°lis rendszer", en: "Gastrointestinal System", de: "Magen-Darm-System" },
                "Orthopedic": { hu: "Ortop√©diai", en: "Orthopedic", de: "Orthop√§disch" }
            };

            const getCategoryName = (category) => categoryTranslations[category] ? categoryTranslations[category][lang] : category;

            // Collect all therapy texts to search for antibiotics
            let allTherapyText = (disease.empiricalTherapy.firstLine[lang] || "") + " " + (disease.empiricalTherapy.alternative[lang] || "");
            if (disease.targetedTherapy) {
                Object.values(disease.targetedTherapy).forEach(val => {
                    if (val && val[lang]) {
                        allTherapyText += " " + val[lang];
                    }
                });
            }

            // Find relevant antibiotics
            const relevantAntibiotics = [];
            if (antibiotics) {
                antibiotics.forEach(ab => {
                    const name = ab.name[lang];
                    if (name) {
                        // Escape special regex chars
                        const escapedName = name.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        // Match whole words, case insensitive
                        const regex = new RegExp(`\\b${escapedName}\\b`, 'i');
                        if (regex.test(allTherapyText)) {
                            relevantAntibiotics.push(ab);
                        }
                    }
                });
            }

            // Generate HTML for relevant antibiotics
            let antibioticsHtml = '';
            if (relevantAntibiotics.length > 0) {
                antibioticsHtml = `
                    <div class="lg:col-span-2 mt-2">
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                            <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">${translations[lang]['relevantAntibioticsInfo'] || 'Relevant Antibiotic Information'}</h4>
                            <div class="grid gap-3 md:grid-cols-2 xl:grid-cols-3">
                `;
                
                relevantAntibiotics.forEach(ab => {
                    antibioticsHtml += `
                        <div class="bg-white p-3 rounded border border-gray-200 shadow-sm hover:shadow-md transition-shadow cursor-pointer" onclick="showModule('pharmacological'); setTimeout(() => { document.getElementById('pharm-search').value = '${ab.name[lang]}'; document.getElementById('pharm-search').dispatchEvent(new Event('input')); }, 100);">
                            <div class="flex justify-between items-start mb-2">
                                <span class="font-bold text-blue-700 text-sm">${ab.name[lang]}</span>
                                <span class="text-[10px] px-1.5 py-0.5 bg-gray-100 rounded text-gray-500">${ab.group.abbreviation || 'AB'}</span>
                            </div>
                            <div class="space-y-1 text-xs text-gray-600">
                                <div class="flex justify-between"><span class="text-gray-400">${translations[lang]['dosage']}:</span> <span class="font-medium text-right ml-2">${ab.dosage.standard[lang]}</span></div>
                                <div class="border-t border-gray-50 pt-1 mt-1 text-gray-500 truncate" title="${ab.sideEffects[lang]}">‚ö†Ô∏è ${ab.sideEffects[lang]}</div>
                            </div>
                        </div>
                    `;
                });
                
                antibioticsHtml += `
                            </div>
                        </div>
                    </div>
                `;
            }

            let detailsHtml = `
                <div class="h-full flex flex-col animate-fade-in">
                    <!-- Header -->
                    <div class="mb-4">
                        <h3 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                            ${disease.name[lang]}
                        </h3>
                        <div class="mt-2 flex flex-wrap gap-2">
                            <span class="px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800 border border-gray-200">${getCategoryName(disease.category)}</span>
                        </div>
                    </div>

                    <!-- Content Grid -->
                    <div class="grid lg:grid-cols-2 gap-4 overflow-y-auto pr-1 custom-scrollbar flex-grow">
                        
                        <!-- Left Column -->
                        <div class="space-y-4">
                            <!-- Pathogens -->
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 border-b border-gray-100 pb-1">${translations[lang]['commonPathogens'] || 'Common Pathogens'}</h4>
                                <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                                    ${disease.commonPathogens.map(p => `<li>${p}</li>`).join('')}
                                </ul>
                            </div>

                            <!-- Empirical Therapy -->
                            <div class="bg-green-50 border border-green-100 rounded-lg p-4 shadow-sm">
                                <h4 class="text-xs font-bold text-green-800 uppercase tracking-wider mb-3 border-b border-green-200 pb-1">${translations[lang]['empiricalTherapy'] || 'Empirical Therapy'}</h4>
                                <div class="space-y-3 text-sm">
                                    <div class="flex flex-col gap-1">
                                        <span class="text-xs text-green-700 font-semibold">${translations[lang]['firstLine'] || 'First Line'}:</span>
                                        <span class="text-gray-800 bg-white/50 p-2 rounded border border-green-100">${disease.empiricalTherapy.firstLine[lang]}</span>
                                    </div>
                                    <div class="flex flex-col gap-1">
                                        <span class="text-xs text-green-700 font-semibold">${translations[lang]['alternative'] || 'Alternative'}:</span>
                                        <span class="text-gray-800 bg-white/50 p-2 rounded border border-green-100">${disease.empiricalTherapy.alternative[lang]}</span>
                                    </div>
                                    <div class="flex items-baseline gap-2 pt-1">
                                        <span class="text-xs text-green-700 font-semibold">${translations[lang]['duration'] || 'Duration'}:</span>
                                        <span class="text-gray-800 font-medium">${disease.empiricalTherapy.duration[lang]}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column -->
                        <div class="space-y-4">
                            <!-- Targeted Therapy -->
                            <div class="bg-blue-50 border border-blue-100 rounded-lg p-4 shadow-sm">
                                <h4 class="text-xs font-bold text-blue-800 uppercase tracking-wider mb-3 border-b border-blue-200 pb-1">${translations[lang]['targetedTherapy'] || 'Targeted Therapy'}</h4>
                                <div class="space-y-2 text-sm">
                                    ${Object.entries(disease.targetedTherapy).map(([key, value]) => `
                                        <div class="bg-white/50 p-2 rounded border border-blue-100">
                                            <strong class="block text-blue-700 text-xs mb-1">${key}</strong>
                                            <span class="text-gray-800">${value[lang]}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <!-- Notes -->
                            ${disease.notes && disease.notes[lang] ? `
                            <div class="bg-amber-50 border border-amber-100 rounded-lg p-4 shadow-sm">
                                <h4 class="text-xs font-bold text-amber-800 uppercase tracking-wider mb-2 flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    ${translations[lang]['notes'] || 'Notes'}
                                </h4>
                                <p class="text-sm text-amber-900 italic leading-relaxed">${disease.notes[lang]}</p>
                            </div>
                            ` : ''}
                        </div>

                        ${antibioticsHtml}
                    </div>
                </div>
            `;
            detailsView.innerHTML = detailsHtml;
        }

        function showMicroDetails(pathogen) {
            const details = document.getElementById('micro-details');
            const lang = currentLanguage;

            details.innerHTML = `
                <div class="text-left">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 italic">${pathogen.name}</h3>
                    
                    <div class="mb-6 border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                            <a href="#" onclick="switchMicroTab(event, 'details')" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-purple-500 text-purple-600" id="micro-tab-details">${translations[lang]['tab-details']}</a>
                            <a href="#" onclick="switchMicroTab(event, 'sensitivity')" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" id="micro-tab-sensitivity">${translations[lang]['tab-sensitivity-micro']}</a>
                        </nav>
                    </div>

                    <div id="micro-tab-content-sensitivity" class="hidden">
                        <h4 class="font-semibold text-teal-800 mb-2">${translations[lang]['tab-sensitivity-micro']}</h4>
                        <div id="micro-sensitivity-info" class="bg-teal-50 p-4 rounded-lg"></div>
                    </div>

                    <div id="micro-tab-content-details">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-purple-800 mb-2">${translations[lang]['identifiers']}</h4>
                                    <p><strong>${translations[lang]['type']}:</strong> ${pathogen.type[lang]}</p>
                                    <p><strong>${translations[lang]['morphology']}:</strong> ${pathogen.morphology[lang]}</p>
                                </div>
                                
                                <div class="bg-indigo-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-indigo-800 mb-2">${translations[lang]['characteristics']}</h4>
                                    <ul class="list-disc list-inside">
                                        ${pathogen.characteristics[lang].map(c => `<li>${c}</li>`).join('')}
                                    </ul>
                                </div>

                                <div class="bg-teal-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-teal-800 mb-2">${translations[lang]['commonInfections']}</h4>
                                    <ul class="list-disc list-inside">
                                         ${pathogen.commonInfections[lang].map(i => `<li>${i}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-800 mb-2">${translations[lang]['therapy']}</h4>
                                    <p><strong>${translations[lang]['firstChoice']}:</strong> ${pathogen.firstChoice.join(', ')}</p>
                                    <p class="mt-2"><strong>${translations[lang]['alternative']}:</strong> ${pathogen.alternative.join(', ')}</p>
                                    <p class="mt-2"><strong>${translations[lang]['resistant']}:</strong> ${pathogen.resistant.join(', ')}</p>
                                </div>
                                
                                <div class="bg-gray-100 p-4 rounded-lg">
                                    <h4 class="font-semibold text-gray-800 mb-2">${translations[lang]['notes']}</h4>
                                    <p class="text-sm">${pathogen.notes[lang]}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Sensitivity data loading
            const sensitivityInfo = document.getElementById('micro-sensitivity-info');
            if (typeof bacteriaSensitivityData !== 'undefined') {
                let data = bacteriaSensitivityData[pathogen.name];
                if (!data) {
                    const key = Object.keys(bacteriaSensitivityData).find(k => k.toLowerCase() === pathogen.name.toLowerCase());
                    if (key) data = bacteriaSensitivityData[key];
                }

                if (data) {
                    const sensitiveAntibiotics = data.filter(item => item.sensitivity === 'S');
                    
                    if (sensitiveAntibiotics.length > 0) {
                        let html = '<ul class="list-disc list-inside space-y-1">';
                        sensitiveAntibiotics.forEach(item => {
                             let content = `${item.antibiotic} <span class="text-xs text-gray-500">(${item.original})</span>`;
                             if (item.resistance) {
                                 content += ` <span class="text-xs text-red-600 font-semibold ml-1">R: ${item.resistance}</span>`;
                             }
                             html += `<li>${content}</li>`;
                        });
                        html += '</ul>';
                        sensitivityInfo.innerHTML = html;
                    } else {
                         sensitivityInfo.innerHTML = `<p>${translations[lang]['no-antibiotic-data']}</p>`;
                    }
                } else {
                    sensitivityInfo.innerHTML = `<p>${translations[lang]['no-data'] || 'Nincs el√©rhet≈ë adat.'}</p>`;
                }
            }
        }

        function switchMicroTab(event, tabName) {
            event.preventDefault();
            document.getElementById('micro-tab-content-details').classList.add('hidden');
            document.getElementById('micro-tab-content-sensitivity').classList.add('hidden');

            document.getElementById('micro-tab-details').className = 'whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300';
            document.getElementById('micro-tab-sensitivity').className = 'whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300';

            document.getElementById(`micro-tab-content-${tabName}`).classList.remove('hidden');
            document.getElementById(`micro-tab-${tabName}`).className = 'whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-purple-500 text-purple-600';
        }

        function setupPharmSearch() {
            const searchInput = document.getElementById('pharm-search');
            const groupFilter = document.getElementById('pharm-group-filter');

            function filterAndDisplay() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedGroup = groupFilter.value;

                const filteredAntibiotics = antibiotics.filter(ab => {
                    const nameMatch = ab.name[currentLanguage].toLowerCase().includes(searchTerm);
                    const groupMatch = !selectedGroup || ab.group[currentLanguage] === selectedGroup;
                    return nameMatch && groupMatch;
                });

                displayPharmList(filteredAntibiotics);
            }

            searchInput.addEventListener('input', filterAndDisplay);
            groupFilter.addEventListener('change', filterAndDisplay);
        }

        function setupClinSearch() {
            const searchInput = document.getElementById('clin-search');
            const categoryFilter = document.getElementById('clin-category-filter');

            function filterAndDisplay() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedCategory = categoryFilter.value;

                const filteredDiseases = diseases.filter(disease => {
                    const nameMatch = disease.name[currentLanguage].toLowerCase().includes(searchTerm);
                    const categoryMatch = !selectedCategory || disease.category === selectedCategory;
                    return nameMatch && categoryMatch;
                });

                displayClinList(filteredDiseases);
            }

            searchInput.addEventListener('input', filterAndDisplay);
            categoryFilter.addEventListener('change', filterAndDisplay);
        }

        function setupMicroSearch() {
            const searchInput = document.getElementById('micro-search');
            const typeFilter = document.getElementById('micro-type-filter');

            function filterAndDisplay() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedType = typeFilter.value;

                const filteredPathogens = pathogens.filter(p => {
                    const nameMatch = p.name.toLowerCase().includes(searchTerm);
                    const typeMatch = !selectedType || p.type[currentLanguage] === selectedType;
                    return nameMatch && typeMatch;
                });

                displayMicroList(filteredPathogens);
            }

            searchInput.addEventListener('input', filterAndDisplay);
            typeFilter.addEventListener('change', filterAndDisplay);
        }

        function refreshCurrentModule() {
            if (!document.getElementById('pharmacological-module').classList.contains('hidden')) {
                document.getElementById('pharm-search').value = '';
                document.getElementById('pharm-group-filter').value = '';
                populatePharmGroups();
                displayPharmList(antibiotics);
            } else if (!document.getElementById('clinical-module').classList.contains('hidden')) {
                document.getElementById('clin-search').value = '';
                document.getElementById('clin-category-filter').value = '';
                populateClinCategories();
                displayClinList(diseases);
            } else if (!document.getElementById('microbiological-module').classList.contains('hidden')) {
                document.getElementById('micro-search').value = '';
                document.getElementById('micro-type-filter').value = '';
                populateMicroTypes();
                displayMicroList(pathogens);
            } else if (!document.getElementById('summary-module').classList.contains('hidden')) {
                generateSummaryTable();
            } else if (!document.getElementById('quiz-module').classList.contains('hidden')) {
                // No refresh needed for quiz setup, it's static
            } else if (!document.getElementById('renal-module').classList.contains('hidden')) {
                document.getElementById('renal-search').value = '';
                displayRenalDoseTable(renalDoses);
            } else if (!document.getElementById('pediatric-module').classList.contains('hidden')) {
                document.getElementById('pediatric-search').value = '';
                displayPediatricDoseTable(pediatricDoses);
            }
        }

        function generateSummaryTable() {
            const tableBody = document.getElementById('summary-table-body');
            if (!tableBody) return;
            
            const groupedAntibiotics = {};
            if (antibiotics) {
                antibiotics.forEach(ab => {
                    if (!ab.group) return; // Skip if group is missing
                    const subgroupText = ab.subgroup ? ab.subgroup[currentLanguage] : '';
                    const groupKey = `${ab.group[currentLanguage]}_${subgroupText}`;
                    if (!groupedAntibiotics[groupKey]) {
                        groupedAntibiotics[groupKey] = [];
                    }
                    groupedAntibiotics[groupKey].push(ab);
                });
            }
            
            tableBody.innerHTML = '';
            
            Object.keys(groupedAntibiotics).sort().forEach(groupKey => {
                const antibioticsInGroup = groupedAntibiotics[groupKey];
                const firstAntibiotic = antibioticsInGroup[0];
                if (!firstAntibiotic) return;
                
                const spectrumSummary = [];
                if (firstAntibiotic.spectrum.gramPos) spectrumSummary.push('Gram+');
                if (firstAntibiotic.spectrum.gramNeg) spectrumSummary.push('Gram-');
                if (firstAntibiotic.spectrum.anaerob) spectrumSummary.push('Anaerob');
                if (firstAntibiotic.spectrum.atypical) spectrumSummary.push('Atypusos');
                if (firstAntibiotic.spectrum.pseudomonas) spectrumSummary.push('Pseudomonas');
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${firstAntibiotic.group[currentLanguage]}</div>
                        <div class="text-sm text-gray-500">${firstAntibiotic.subgroup ? firstAntibiotic.subgroup[currentLanguage] : ''}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${firstAntibiotic.effect[currentLanguage] === 'Bactericid' || firstAntibiotic.effect[currentLanguage] === 'Bactericidal' || firstAntibiotic.effect[currentLanguage] === 'Bakterizid' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'}">
                            ${firstAntibiotic.effect[currentLanguage]}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-900">${firstAntibiotic.mechanism[currentLanguage]}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-900">${spectrumSummary.join(', ')}</div>
                        ${firstAntibiotic.spectrum.other[currentLanguage] ? `<div class="text-xs text-gray-500 mt-1">${firstAntibiotic.spectrum.other[currentLanguage]}</div>` : ''}
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-900">${antibioticsInGroup.map(ab => `${ab.name[currentLanguage]}${ab.group.abbreviation ? ` (${ab.group.abbreviation})` : ''}`).join(', ')}</div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        let currentRenalSort = { column: 'antibiotic_name', direction: 'asc' };

        function sortRenalTable(column) {
            if (currentRenalSort.column === column) {
                currentRenalSort.direction = currentRenalSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentRenalSort.column = column;
                currentRenalSort.direction = 'asc';
            }
            if (window.triggerRenalFilter) window.triggerRenalFilter();
        }

        function updateRenalSortIcons() {
            const headers = {
                'antibiotic_name': 'th-renal-antibiotic',
                'gfr_gt_50': 'th-renal-gfr50',
                'gfr_30_50': 'th-renal-gfr30-50',
                'gfr_10_29': 'th-renal-gfr10-29',
                'gfr_lt_10': 'th-renal-gfr-lt10',
                'hd': 'th-renal-hd',
                'crrt': 'th-renal-crrt'
            };

            for (const [col, id] of Object.entries(headers)) {
                const th = document.getElementById(id);
                if (th) {
                    const existingIcon = th.querySelector('.sort-icon');
                    if (existingIcon) existingIcon.remove();
                    if (currentRenalSort.column === col) {
                        th.innerHTML += `<span class="sort-icon ml-1 text-gray-500">${currentRenalSort.direction === 'asc' ? '‚ñ≤' : '‚ñº'}</span>`;
                    }
                }
            }
        }

        function setupRenalSearch() {
            const searchInput = document.getElementById('renal-search');
            const routeRadios = document.getElementsByName('renal-route-filter');

            function filterAndDisplay() {
                const searchTerm = searchInput.value.toLowerCase();
                let filterRoute = 'all';
                for (const radio of routeRadios) {
                    if (radio.checked) {
                        filterRoute = radio.value;
                        break;
                    }
                }

                const filteredDoses = renalDoses.filter(dose => {
                    const matchesSearch = dose.antibiotic_name.toLowerCase().includes(searchTerm);
                    let matchesRoute = true;
                    if (filterRoute !== 'all') {
                        const route = dose.route || 'IV'; // Ha nincs megadva, IV-nek tekintj√ºk
                        matchesRoute = route.includes(filterRoute);
                    }
                    return matchesSearch && matchesRoute;
                });

                // Sorting logic
                filteredDoses.sort((a, b) => {
                    let valA = a[currentRenalSort.column];
                    let valB = b[currentRenalSort.column];

                    // Handle objects (dose info)
                    if (typeof valA === 'object' && valA !== null) valA = valA.dose;
                    if (typeof valB === 'object' && valB !== null) valB = valB.dose;

                    valA = (valA || '').toString().toLowerCase();
                    valB = (valB || '').toString().toLowerCase();

                    if (valA < valB) return currentRenalSort.direction === 'asc' ? -1 : 1;
                    if (valA > valB) return currentRenalSort.direction === 'asc' ? 1 : -1;
                    return 0;
                });

                displayRenalDoseTable(filteredDoses);
                updateRenalSortIcons();
            }

            searchInput.addEventListener('input', filterAndDisplay);
            for (const radio of routeRadios) {
                radio.addEventListener('change', filterAndDisplay);
            }
            window.triggerRenalFilter = filterAndDisplay;
        }

        function setupPediatricSearch() {
            const searchInput = document.getElementById('pediatric-search');
            if (!searchInput) return;

            function filterAndDisplay() {
                const searchTerm = searchInput.value.toLowerCase();

                const filteredDoses = pediatricDoses.filter(dose => {
                    return dose.antibiotic_name.toLowerCase().includes(searchTerm);
                });

                displayPediatricDoseTable(filteredDoses);
            }

            searchInput.addEventListener('input', filterAndDisplay);
        }

        function displayPediatricDoseTable(list) {
            const tableBody = document.getElementById('pediatric-table-body');
            if (!tableBody) return;
            tableBody.innerHTML = '';

            if (!list || list.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="2" class="text-center p-4">${translations[currentLanguage]['no-data'] || 'No data available.'}</td></tr>`;
                return;
            }

            list.forEach(dose => {
                const row = document.createElement('tr');
                let doseHtml = '<ul class="list-disc list-inside space-y-1">';
                for (const [key, value] of Object.entries(dose.doses)) {
                     const translatedKey = translations[currentLanguage][key] || key.replace(/_/g, ' ');
                     doseHtml += `<li><strong class="capitalize text-gray-600">${translatedKey}:</strong> ${value}</li>`;
                }
                doseHtml += '</ul>';
                row.innerHTML = `<td class="px-6 py-4 font-medium text-gray-900 align-top">${dose.antibiotic_name}</td><td class="px-6 py-4 text-gray-700">${doseHtml}</td>`;
                tableBody.appendChild(row);
            });
        }

        function displayRenalDoseTable(list) {
            const tableBody = document.getElementById('renal-table-body');
            if (!tableBody) return;
            tableBody.innerHTML = '';

            if (!list || list.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="7" class="text-center p-4">${translations[currentLanguage]['no-data'] || 'No data available.'}</td></tr>`;
                return;
            }

            const renderCell = (data) => {
                if (typeof data === 'string') {
                    return `<div class="text-xs text-gray-700">${data}</div>`;
                }
                if (typeof data === 'object' && data !== null) {
                    let html = `<div class="font-semibold text-gray-900 text-xs">${data.dose} ${data.interval || ''}</div>`;
                    if (data.notes) {
                        html += `<div class="text-[10px] text-gray-500 mt-1 italic">${data.notes}</div>`;
                    }
                    return html;
                }
                return '';
            };

            list.forEach(dose => {
                let nameHtml = `<div class="text-xs font-medium text-gray-900">${dose.antibiotic_name}</div>`;
                
                if (dose.route) {
                    const badgeClass = dose.route.includes('PO') ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800';
                    nameHtml += `<span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium ${badgeClass} mt-0.5">${dose.route}</span>`;
                }
                
                const serumLevelText = {
                    'Vancomycin': { hu: 'V√∂lgy: 15-20 mg/L', en: 'Trough: 15-20 mg/L', de: 'Talspiegel: 15-20 mg/L' },
                    'Gentamicin': {
                        hu: 'Cs√∫cs: <10, V√∂lgy: <1 mg/L',
                        en: 'Peak: <10, Trough: <1 mg/L',
                        de: 'Spitze: <10, Tal: <1 mg/L'
                    },
                    'Amikacin': {
                        hu: 'Cs√∫cs: 20-30, V√∂lgy: <5 mg/L',
                        en: 'Peak: 20-30, Trough: <5 mg/L',
                        de: 'Spitze: 20-30, Tal: <5 mg/L'
                    }
                };

                if (serumLevelText[dose.antibiotic_name]) {
                    nameHtml += `<div class="text-[10px] text-gray-500">${serumLevelText[dose.antibiotic_name][currentLanguage]}</div>`;
                }

                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-2 py-2 whitespace-nowrap">${nameHtml}</td>
                    <td class="px-2 py-2 gfr-normal">${renderCell(dose.gfr_gt_50)}</td>
                    <td class="px-2 py-2 gfr-mild-moderate">${renderCell(dose.gfr_30_50)}</td>
                    <td class="px-2 py-2 gfr-moderate">${renderCell(dose.gfr_10_29)}</td>
                    <td class="px-2 py-2 gfr-severe">${renderCell(dose.gfr_lt_10)}</td>
                    <td class="px-2 py-2">${renderCell(dose.hd)}</td>
                    <td class="px-2 py-2">${renderCell(dose.crrt)}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function exportToPDF(type = 'summary') {
            const printWindow = window.open('', '_blank');
            let table;
            let title;
            let description;

            if (type === 'detailed') {
                title = translations[currentLanguage]['pharm-module-title'];
                description = translations[currentLanguage]['pharm-desc'];
                table = generateDetailedAntibioticsTable();
            } else {
                title = translations[currentLanguage]['summary-table-title'];
                description = translations[currentLanguage]['summary-table-desc'];
                table = document.getElementById('summary-table-container').innerHTML;
            }

            function generateDetailedAntibioticsTable() {
                const lang = currentLanguage;
                let tableHtml = '<table class="detailed-table">';
                
                if (!antibiotics || antibiotics.length === 0) {
                    return '<p>Nincsenek adatok.</p>';
                }

                antibiotics.forEach(ab => {
                    const spectrumIcons = {
                        gramPos: ab.spectrum.gramPos ? '‚úÖ' : '‚ùå',
                        gramNeg: ab.spectrum.gramNeg ? '‚úÖ' : '‚ùå',
                        anaerob: ab.spectrum.anaerob ? '‚úÖ' : '‚ùå',
                        atypical: ab.spectrum.atypical ? '‚úÖ' : '‚ùå',
                        pseudomonas: ab.spectrum.pseudomonas ? '‚úÖ' : '‚ùå'
                    };

                    tableHtml += `
                        <thead>
                            <tr><th colspan="2" class="antibiotic-name">${ab.name[lang]}</th></tr>
                        </thead>
                        <tbody>
                            <tr><td class="category" colspan="2">${translations[lang]['basicData']}</td></tr>
                            <tr><td>${translations[lang]['group']}</td><td>${ab.group[lang]}</td></tr>
                            <tr><td>${translations[lang]['subgroup']}</td><td>${ab.subgroup ? ab.subgroup[lang] : ''}</td></tr>
                            <tr><td>${translations[lang]['effect']}</td><td>${ab.effect[lang]}</td></tr>
                            <tr><td>${translations[lang]['halfLife']}</td><td>${ab.halfLife[lang]}</td></tr>
                            <tr><td>${translations[lang]['pae']}</td><td>${ab.pae[lang]}</td></tr>
                            
                            <tr><td class="category" colspan="2">${translations[lang]['mechanism']}</td></tr>
                            <tr><td colspan="2">${ab.mechanism[lang]}</td></tr>

                            <tr><td class="category" colspan="2">${translations[lang]['dosage']}</td></tr>
                            <tr><td>${translations[lang]['standard']}</td><td>${ab.dosage.standard[lang]}</td></tr>
                            <tr><td>${translations[lang]['high']}</td><td>${ab.dosage.high[lang]}</td></tr>
                            <tr><td>${translations[lang]['oral']}</td><td>${ab.dosage.oral[lang]}</td></tr>
                            <tr><td>${translations[lang]['routes']}</td><td>${ab.routes.join(', ')}</td></tr>

                            <tr><td class="category" colspan="2">${translations[lang]['spectrum']}</td></tr>
                            <tr><td>${translations[lang]['gramPositive']}</td><td>${spectrumIcons.gramPos}</td></tr>
                            <tr><td>${translations[lang]['gramNegative']}</td><td>${spectrumIcons.gramNeg}</td></tr>
                            <tr><td>${translations[lang]['anaerobe']}</td><td>${spectrumIcons.anaerob}</td></tr>
                            <tr><td>${translations[lang]['atypical']}</td><td>${spectrumIcons.atypical}</td></tr>
                            <tr><td>${translations[lang]['pseudomonas']}</td><td>${spectrumIcons.pseudomonas}</td></tr>
                            <tr><td>${translations[lang]['other']}</td><td>${ab.spectrum.other[lang]}</td></tr>

                            <tr><td class="category" colspan="2">${translations[lang]['sideEffects']}</td></tr>
                            <tr><td colspan="2">${ab.sideEffects[lang]}</td></tr>
                        </tbody>
                    `;
                });

                tableHtml += '</table>';
                return tableHtml;
            }

            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Antibiotikum √ñsszefoglal√≥ T√°bl√°zat</title>
                    <meta charset="UTF-8">
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px;
                            font-size: 12px;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                            border-bottom: 2px solid #333;
                            padding-bottom: 10px;
                        }
                        .header h1 { margin: 0; color: #333; }
                        .header p { margin: 5px 0; color: #666; }
                        
                        /* Summary Table Styles */
                        .header h1 {
                            margin: 0;
                            color: #333;
                        }
                        .header p {
                            margin: 5px 0;
                            color: #666;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-top: 20px;
                        }
                        th, td { 
                            border: 1px solid #ddd; 
                            padding: 8px; 
                            text-align: left;
                            vertical-align: top;
                        }
                        th { 
                            background-color: #f8f9fa; 
                            font-weight: bold;
                            color: #333;
                        }
                        tr:nth-child(even) { 
                            background-color: #f9f9f9; 
                        }
                        .badge {
                            display: inline-block;
                            padding: 2px 6px;
                            border-radius: 12px;
                            font-size: 10px;
                            font-weight: bold;
                        }
                        .badge-red {
                            background-color: #fee2e2;
                            color: #991b1b;
                        }
                        .badge-blue {
                            background-color: #dbeafe;
                            color: #1e40af;
                        }

                        /* Detailed Table Styles */
                        .detailed-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 20px;
                            page-break-inside: auto;
                        }
                        .detailed-table th, .detailed-table td {
                            border: 1px solid #ccc;
                            padding: 8px;
                            text-align: left;
                        }
                        .detailed-table thead { page-break-before: always; }
                        .detailed-table tbody { page-break-inside: avoid; }
                        .detailed-table .antibiotic-name { background-color: #333; color: white; font-size: 1.2em; text-align: center; }
                        .detailed-table .category { background-color: #e9ecef; font-weight: bold; text-align: center; }
                        .detailed-table td:first-child { font-weight: bold; width: 30%; }
                        }
                        @media print {
                            body { margin: 0; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${title}</h1>
                        <p>¬© 2025, Dr. P√©terfi Zolt√°n | ${currentLanguage === 'hu' ? 'Verzi√≥' : currentLanguage === 'en' ? 'Version' : 'Version'}: 4.3.6</p>
                        <p>${description}</p>
                    </div>
                    ${table}
                    <div style="margin-top: 30px; text-align: center; color: #666; font-size: 10px;">
                        ${new Date().toLocaleDateString()} - Antibiotikum Oktat√≥ Program
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }

        function exportDiseasesToPDF() {
            const printWindow = window.open('', '_blank');
            const lang = currentLanguage;

            const categoryTranslations = {
                "CNS": { hu: "K√∂zponti idegrendszer", en: "Central Nervous System", de: "Zentralnervensystem" },
                "Respiratory": { hu: "L√©gz≈ërendszer", en: "Respiratory System", de: "Atmungssystem" },
                "Cardiovascular": { hu: "Sz√≠v- √©s √©rrendszer", en: "Cardiovascular System", de: "Herz-Kreislauf-System" },
                "Urogenital": { hu: "Urogenit√°lis rendszer", en: "Urogenital System", de: "Urogenitalsystem" },
                "Skin": { hu: "B≈ër √©s l√°gyr√©szek", en: "Skin and Soft Tissues", de: "Haut und Weichteile" },
                "Sepsis": { hu: "Szepszis", en: "Sepsis", de: "Sepsis" },
                "Gastrointestinal": { hu: "Gastrointestin√°lis rendszer", en: "Gastrointestinal System", de: "Magen-Darm-System" },
                "Orthopedic": { hu: "Ortop√©diai", en: "Orthopedic", de: "Orthop√§disch" }
            };
            const getCategoryName = (category) => categoryTranslations[category] ? categoryTranslations[category][lang] : category;

            function generateDetailedDiseasesTable() {
                let tableHtml = '<div class="diseases-container">';
                
                if (!diseases || diseases.length === 0) {
                    return '<p>Nincsenek adatok.</p>';
                }

                diseases.forEach(disease => {
                    tableHtml += `
                        <div class="disease-block">
                            <h3 class="disease-name">${disease.name[lang]}</h3>
                            <p class="disease-category"><strong>${translations[lang]['category']}:</strong> ${getCategoryName(disease.category)}</p>
                            
                            <div class="section">
                                <h4 class="section-title">${translations[lang]['commonPathogens']}</h4>
                                <p>${disease.commonPathogens.join(', ')}</p>
                            </div>

                            <div class="section">
                                <h4 class="section-title">${translations[lang]['empiricalTherapy']}</h4>
                                <p><strong>${translations[lang]['firstLine']}:</strong> ${disease.empiricalTherapy.firstLine[lang]}</p>
                                <p><strong>${translations[lang]['alternative']}:</strong> ${disease.empiricalTherapy.alternative[lang]}</p>
                                <p><strong>${translations[lang]['duration']}:</strong> ${disease.empiricalTherapy.duration[lang]}</p>
                            </div>

                            <div class="section">
                                <h4 class="section-title">${translations[lang]['targetedTherapy']}</h4>
                                ${Object.entries(disease.targetedTherapy).map(([key, value]) => `<p><strong>${key}:</strong> ${value[lang]}</p>`).join('')}
                            </div>

                            ${disease.notes && disease.notes[lang] ? `
                            <div class="section">
                                <h4 class="section-title">${translations[lang]['notes']}</h4>
                                <p>${disease.notes[lang]}</p>
                            </div>
                            ` : ''}
                        </div>
                    `;
                });

                tableHtml += '</div>';
                return tableHtml;
            }

            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${translations[lang]['clin-module-title']}</title>
                    <meta charset="UTF-8">
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; font-size: 12px; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 10px; }
                        .header h1 { margin: 0; color: #333; }
                        .header p { margin: 5px 0; color: #666; }
                        .diseases-container { display: flex; flex-direction: column; gap: 20px; }
                        .disease-block { border: 1px solid #ccc; border-radius: 8px; padding: 15px; page-break-inside: avoid; }
                        .disease-name { font-size: 1.3em; font-weight: bold; color: #333; margin-top: 0; margin-bottom: 5px; }
                        .disease-category { font-size: 0.9em; color: #555; margin-bottom: 15px; }
                        .section { margin-bottom: 10px; }
                        .section-title { font-weight: bold; color: #444; border-bottom: 1px solid #eee; padding-bottom: 3px; margin-bottom: 5px; }
                        .section p { margin: 2px 0; }
                        .section p strong { color: #111; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${translations[lang]['clin-module-title']}</h1>
                        <p>¬© 2025, Dr. P√©terfi Zolt√°n | ${currentLanguage === 'hu' ? 'Verzi√≥' : currentLanguage === 'en' ? 'Version' : 'Version'}: 4.3.6</p>
                    </div>
                    ${generateDetailedDiseasesTable()}
                </body>
                </html>
            `;
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            setTimeout(() => { printWindow.print(); }, 500);
        }

        function exportRenalDosesToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4');
            const lang = currentLanguage;

            doc.setFontSize(16);
            doc.text(translations[lang]['renal-table-title'], 14, 15);
            
            doc.setFontSize(10);
            doc.setTextColor(100);
            doc.text(`¬© 2025, Dr. P√©terfi Zolt√°n | ${lang === 'hu' ? 'Verzi√≥' : 'Version'}: 4.3.6`, 14, 22);

            const head = [[
                translations[lang]['th-renal-antibiotic'],
                translations[lang]['th-renal-gfr50'],
                translations[lang]['th-renal-gfr30-50'],
                translations[lang]['th-renal-gfr10-29'],
                translations[lang]['th-renal-gfr-lt10'],
                translations[lang]['th-renal-hd'],
                translations[lang]['th-renal-crrt']
            ]];

            const formatVal = (val) => {
                if (!val) return '-';
                if (typeof val === 'string') return val;
                if (typeof val === 'object') {
                    let str = val.dose;
                    if (val.interval) str += ` ${val.interval}`;
                    if (val.notes) str += `\n(${val.notes})`;
                    return str;
                }
                return '-';
            };

            const sortedDoses = [...renalDoses].sort((a, b) => a.antibiotic_name.localeCompare(b.antibiotic_name));
            
            const body = sortedDoses.map(item => [
                item.antibiotic_name + (item.route ? ` [${item.route}]` : ''),
                formatVal(item.gfr_gt_50),
                formatVal(item.gfr_30_50),
                formatVal(item.gfr_10_29),
                formatVal(item.gfr_lt_10),
                formatVal(item.hd),
                formatVal(item.crrt)
            ]);

            doc.autoTable({
                head: head,
                body: body,
                startY: 25,
                theme: 'grid',
                styles: { fontSize: 8, cellPadding: 2, overflow: 'linebreak' },
                headStyles: { fillColor: [220, 38, 38], textColor: 255, fontStyle: 'bold' },
                columnStyles: { 0: { fontStyle: 'bold', cellWidth: 35 } }
            });

            doc.save('vesekarocodas_dozisok.pdf');
        }

        function exportPathogensToPDF() {
            const printWindow = window.open('', '_blank');
            const lang = currentLanguage;

            function generateDetailedPathogensTable() {
                let tableHtml = '<div class="pathogens-container">';
                
                if (!pathogens || pathogens.length === 0) {
                    return '<p>Nincsenek adatok.</p>';
                }

                pathogens.forEach(pathogen => {
                    tableHtml += `
                        <div class="pathogen-block">
                            <h3 class="pathogen-name"><i>${pathogen.name}</i></h3>
                            
                            <div class="section">
                                <h4 class="section-title">${translations[lang]['identifiers']}</h4>
                                <p><strong>${translations[lang]['type']}:</strong> ${pathogen.type[lang]}</p>
                                <p><strong>${translations[lang]['morphology']}:</strong> ${pathogen.morphology[lang]}</p>
                            </div>

                            <div class="section">
                                <h4 class="section-title">${translations[lang]['characteristics']}</h4>
                                <ul class="list-disc list-inside">${pathogen.characteristics[lang].map(c => `<li>${c}</li>`).join('')}</ul>
                            </div>

                            <div class="section">
                                <h4 class="section-title">${translations[lang]['commonInfections']}</h4>
                                <ul class="list-disc list-inside">${pathogen.commonInfections[lang].map(i => `<li>${i}</li>`).join('')}</ul>
                            </div>

                            <div class="section">
                                <h4 class="section-title">${translations[lang]['therapy']}</h4>
                                <p><strong>${translations[lang]['firstChoice']}:</strong> ${pathogen.firstChoice.join(', ')}</p>
                                <p><strong>${translations[lang]['alternative']}:</strong> ${pathogen.alternative.join(', ')}</p>
                                <p><strong>${translations[lang]['resistant']}:</strong> ${pathogen.resistant.join(', ')}</p>
                            </div>

                            ${pathogen.notes && pathogen.notes[lang] ? `
                            <div class="section">
                                <h4 class="section-title">${translations[lang]['notes']}</h4>
                                <p>${pathogen.notes[lang]}</p>
                            </div>
                            ` : ''}
                        </div>
                    `;
                });

                tableHtml += '</div>';
                return tableHtml;
            }

            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${translations[lang]['micro-module-title']}</title>
                    <meta charset="UTF-8">
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; font-size: 12px; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 10px; }
                        .header h1 { margin: 0; color: #333; }
                        .header p { margin: 5px 0; color: #666; }
                        .pathogens-container { display: flex; flex-direction: column; gap: 20px; }
                        .pathogen-block { border: 1px solid #ccc; border-radius: 8px; padding: 15px; page-break-inside: avoid; }
                        .pathogen-name { font-size: 1.3em; font-weight: bold; color: #333; margin-top: 0; margin-bottom: 15px; }
                        .section { margin-bottom: 10px; }
                        .section-title { font-weight: bold; color: #444; border-bottom: 1px solid #eee; padding-bottom: 3px; margin-bottom: 5px; }
                        .section p, .section ul { margin: 2px 0; }
                        .section p strong { color: #111; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${translations[lang]['micro-module-title']}</h1>
                        <p>¬© 2025, Dr. P√©terfi Zolt√°n | ${currentLanguage === 'hu' ? 'Verzi√≥' : currentLanguage === 'en' ? 'Version' : 'Version'}: 4.3.6</p>
                    </div>
                    ${generateDetailedPathogensTable()}
                </body>
                </html>
            `;
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            setTimeout(() => { printWindow.print(); }, 500);
        }

        // --- QUIZ LOGIC ---

        function startQuiz() {
            const topic = document.getElementById('quiz-topic').value;
            const count = parseInt(document.getElementById('quiz-questions').value);
            const difficulty = document.getElementById('quiz-difficulty').value;

            currentQuestions = generateQuestions(topic, count, difficulty);
            currentQuestionIndex = 0;
            score = 0;

            document.getElementById('quiz-setup').classList.add('hidden');
            document.getElementById('quiz-results').classList.add('hidden');
            document.getElementById('quiz-area').classList.remove('hidden');

            displayQuestion();
        }

        function restartQuiz() {
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('quiz-results').classList.add('hidden');
            document.getElementById('quiz-setup').classList.remove('hidden');
        }

        function displayQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            document.getElementById('question-text').innerHTML = question.question;
            
            const answersContainer = document.getElementById('answers-container');
            answersContainer.innerHTML = '';
            question.answers.forEach(answer => {
                const button = document.createElement('button');
                button.innerHTML = answer.text;
                button.className = 'block w-full text-left p-4 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors';
                button.onclick = () => checkAnswer(button, answer.correct);
                answersContainer.appendChild(button);
            });

            document.getElementById('feedback-container').innerHTML = '';
            const nextBtn = document.getElementById('next-question-btn');
            nextBtn.classList.add('hidden');
            nextBtn.textContent = translations[currentLanguage]['next-btn'];
            
            document.getElementById('quiz-progress').textContent = `${translations[currentLanguage]['question']} ${currentQuestionIndex + 1} ${translations[currentLanguage]['of']} ${currentQuestions.length}`;
            document.getElementById('quiz-score').textContent = `${translations[currentLanguage]['score']}: ${score}`;
        }

        function checkAnswer(button, isCorrect) {
            Array.from(document.getElementById('answers-container').children).forEach(btn => {
                btn.disabled = true;
                const correspondingAnswer = currentQuestions[currentQuestionIndex].answers.find(a => a.text === btn.innerHTML);
                if (correspondingAnswer.correct) {
                    btn.className = 'block w-full text-left p-4 bg-green-200 text-green-800 rounded-lg';
                }
            });

            const feedbackContainer = document.getElementById('feedback-container');
            if (isCorrect) {
                score++;
                button.className = 'block w-full text-left p-4 bg-green-200 text-green-800 rounded-lg';
                feedbackContainer.textContent = translations[currentLanguage]['correct-answer'];
                feedbackContainer.className = 'mt-4 text-center font-bold text-green-600';
            } else {
                button.className = 'block w-full text-left p-4 bg-red-200 text-red-800 rounded-lg';
                const correctAnswer = currentQuestions[currentQuestionIndex].answers.find(a => a.correct).text;
                feedbackContainer.innerHTML = `${translations[currentLanguage]['wrong-answer']} <br><i>${correctAnswer}</i>`;
                feedbackContainer.className = 'mt-4 text-center font-bold text-red-600';
            }

            document.getElementById('quiz-score').textContent = `${translations[currentLanguage]['score']}: ${score}`;
            document.getElementById('next-question-btn').classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuestions.length) {
                displayQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('quiz-results').classList.remove('hidden');
            document.getElementById('final-score').textContent = `${score} / ${currentQuestions.length}`;
            document.getElementById('score-text').textContent = translations[currentLanguage]['score-text'];
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function generateQuestions(topic, count, difficulty) {
            if (!testQuestions || testQuestions.length === 0) {
                console.error("A tesztk√©rd√©sek nincsenek bet√∂ltve a(z) " + currentLanguage + " nyelven.");
                alert("Hiba: A tesztk√©rd√©sek nem t√∂lt≈ëdtek be. K√©rlek, friss√≠tsd az oldalt.");
                return [];
            }
            
            const availableQuestions = testQuestions.filter(q => 
                q.topic === topic && q.difficulty === difficulty
            );

            const shuffled = shuffleArray(availableQuestions);
            return shuffled.slice(0, count);
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Bet√∂lt√©s magyarul indul√°skor
            antibiotics = window.antibiotics_hu || [];
            diseases = window.diseases_hu || [];
            pathogens = window.pathogens_hu || [];
            testQuestions = (window.test_hu || []).concat(window.test_new || []);
            renalDoses = window.renal_dose_hu || [];
            pediatricDoses = window.pediatric_doses_hu || [];
            changeLanguage('hu');
});
    </script>
</body>
</html>